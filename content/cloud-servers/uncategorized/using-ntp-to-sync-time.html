---
node_id: 3406
title: Using NTP to Sync Time
permalink: article/using-ntp-to-sync-time
type: article
created_date: '2013-04-15 21:50:43'
created_by: jered.heeschen
last_modified_date: '2013-04-18 20:3015'
last_modified_by: jered.heeschen
products: Cloud Servers
categories: Uncategorized
body_format: tinymce
---

<p>Keeping your system’s date and time accurate is easy to do using NTP.</p><p>Having an accurate clock on your server ensures that time stamps in emails sent from your machine are correct. An accurate clock is especially helpful when you need to look at the logs from a particular time of day.</p><p><span style="line-height: 1.538em;">If you don't occasionally set the system clock yourself, the time will slowly drift away from a perfectly accurate setting. That's when the network time protocol (NTP) is useful.</span></p><h3>What is NTP?</h3><p>NTP lets you automatically sync your system time with a remote server. The NTP can be used to update the clock on a machine with a remote server. This keeps your machine's time accurate by syncing with servers that are known to have accurate times. NTP also keeps the clocks on several machines in sync, thus making it easier to match log entries for an event across multiple servers.</p><p>It's easy to set up an NTP server to regularly adjust your machine's clock. It's also possible to make it a bit more complicated if you need your clock accurate down to the millisecond instead of just to the second.</p><h3>Install</h3><p>The first thing to do is install the NTP server. Grab the package by running:</p><h4>Ubuntu / Debian:</h4><pre>sudo aptitude update<br />sudo aptitude install ntp
</pre><h4>CentOS:</h4><pre>sudo yum install ntp
</pre><p>Once installed, you can ensure the service will run at boot time by running:</p><pre>sudo /sbin/chkconfig ntpd on
</pre><h4>Fedora / RHEL:</h4><pre>sudo yum install ntp
</pre><p>Once installed, you can ensure the service will run at boot time by running:</p><pre>sudo chkconfig ntpd on
</pre><h4>Arch:</h4><pre>sudo pacman –Sy ntp
</pre><p>Once installed, you can ensure the service will run at boot time by adding “ntpd” to the “DAEMONS” value in the rc.conf file here:</p><pre>/etc/rc.conf
</pre><h4>Gentoo:</h4><pre>sudo emerge –sync
sudo emerge ntp
</pre><p>Once installed, you can ensure the service will run at boot time by running:</p><pre>sudo ln –s /etc/init.d/ntpd /etc/runlevels/default
</pre><div><h3>Start the service</h3><p>To make sure the NTP service starts after installing it, run:</p><h4>Ubuntu / Debian / CentOS / RHEL / Gentoo:</h4><pre>sudo /etc/init.d/ntp start
</pre><h4>Fedora:</h4><pre>sudo /etc/init.d/ntpd start
</pre><h4>Arch:</h4><pre>sudo /etc/rc.d/ntpd start
</pre><p>As is usual for Linux services, you can stop or restart the NTP service by running the above command with</p><pre>stop
</pre><p>or</p><pre>restart
</pre><p>sent as the argument instead of start.</p></div><h3>Quickstart</h3><p>Most people just want to get NTP running and don't need to sync their clock to pinpoint, millisecond-level accuracy. In this case, nothing more needs to be done. When you installed NTP, it set you up with default servers to sync with. NTP will now sync your clock automatically. Congratulations on a job well done!</p><h3>The .ntpconf file</h3><p>If you want to use NTP to sync several of your own machines, or if you want to choose NTP servers other than the defaults, the NTP configuration file can be found at</p><pre>/etc/ntp.conf
</pre><p>There are a few settings that can be changed, but the only settings of interest to most users include any server entries. Use the default settings for your specific Linux distribution.</p><p>With more than one server entry, your NTP server will query all servers and select a time that the majority of the polled servers agree on. By using three or more servers, your clock will be more accurate than if it uses only one.</p><p>Adding the iBurst option after the server address will speed up the NTP time sync slightly. While this is helpful, it isn't essential.</p><p>The dynamic option tells NTP that it can try a configured server again later if it's unavailable at some point. The dynamic option is useful when NTP is running on a machine that doesn't always have access to the Internet. It is not necessary on a machine with a dedicated connection.</p><h3>Syncing multiple servers</h3><p>If you have more than one machine to sync, it is best to designate one as the master NTP server. Set up the master server to connect to an outside NTP server, then have the other machines sync to the master. This setup reduces the number of outgoing connections and guarantees that all of your machines have their time set to the same value. This configuration requires changes to the server settings in the ntp.conf files on each machine.</p><p>Set up any external servers you want to use on the master machine. For example, if you want to use the NTP pool servers (<a href="#poolservers">more on that later</a>) you can set the server values in the master ntp.conf file to:</p><pre>server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
server 3.pool.ntp.org iburst
</pre><p>Point the ntp.conf to your master server on every other machine for which you want to sync the time. For example, if your master server is "main.example.com," you would alter the ntp.conf files on the secondary machines so that the server entries are as follows:</p><pre>server main.example.com iburst
</pre><p>After setting the server parameters and ensuring that the iptables don't block connections to your main NTP server, restart the NTP services on each machine to get them syncing.</p><h4>Adjusting iptables</h4><p>NTP uses UDP port 123 to conduct its business, either connecting out to another NTP server or accepting incoming connections. If you have iptables filtering incoming traffic on the main NTP server in your cluster, then you'll need to open port 123 to UDP traffic to allow the other servers to connect to it. You can open port 123 for UDP traffic with the following iptables arguments:</p><pre>-I INPUT -p udp --dport 123 -j ACCEPT
-I OUTPUT -p udp --sport 123 -j ACCEPT
</pre><h3>Choosing an NTP server</h3><p>When syncing one or more machines via NTP, you'll want at least one of them to set their time from a reliable external server. There are many public servers out there that are either synced directly from an atomic clock (guaranteeing an absolutely accurate time), or are synced from another server that syncs to an atomic clock.</p><h4>Public NTP server lists</h4><p>The best source for lists of public NTP servers is the <a href="http://support.ntp.org/bin/view/Servers/WebHome">NTP Servers WebHome</a> at the main NTP site. At the site is a description of the servers available, and in the sidebar are links to three levels of NTP servers: Primary, secondary, and pool.</p><p><img src="/knowledge_center/sites/default/files/field/image/usingntp_0.png" alt="" width="183" height="249" /></p><p>Deciding what type of server to sync from will depend on how accurate you need your servers to be.</p><h4><a id="poolservers" name="poolservers"></a>NTP pool servers</h4><p>For most users, the pool servers are the best choice. Pool servers are machines that have volunteered to make their NTP server available to the public. They typically sync from a secondary NTP server so their time is accurate, but not necessarily accurate to the nearest millisecond.</p><p>Most users don't need their machine time accurate to the nearest millisecond; they just want to know what time it is. Use the pool servers unless you need pinpoint accuracy.</p><p>Using the NTP pool servers is as easy as setting the server entries in your ntp.conf file to:</p><pre>server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
server 3.pool.ntp.org iburst
</pre><p>To ensure that you only connect to pool servers in your own country or region, visit the <a href="http://support.ntp.org/bin/view/Servers/NTPPoolServers">pool servers page</a> for more specific addresses. For most people, the above entries will be more than sufficient. Those addresses rotate among a huge list of volunteer NTP servers worldwide so the load on any one machine never gets too great.</p><p>If you want to contribute to the NTP pool once you've set up your NTP server, get details on how to do so from the <a href="http://www.pool.ntp.org/en/join.html">pool website</a>.</p><h4>Primary and secondary servers</h4><p>The other two tiers of NTP servers are primary and secondary servers. A primary server is one that gets its time directly from an atomic clock (or from GPS satellites, which use atomic clocks). Atomic clocks are expensive so there aren't many primary servers. You don't have to use a primary server unless you're looking for extreme scientific accuracy.</p><p>A secondary server usually gets its time from a primary server. If you want accuracy down to the millisecond level, having three secondary servers in your ntp.conf will work well.</p><p>You can see what public servers are available in either tier by selecting either list from the <a href="http://support.ntp.org/bin/view/Servers/WebHome">NTP Servers WebHome</a>. Before selecting and using a server, check the details for that server as follows:</p><ul><li><strong>ISO:</strong> The ISO column lists the country of origin of that particular server.</li><li><strong>AccessPolicy:</strong> The AccessPolicy field tells you what the access policy is for that server. <strong>Open Access</strong> means the server can be used by the public, subject to any notification requirements the server has.</li><li><strong>Notify:</strong> The Notify field for secondary servers lists the preferences of that server's administrator regarding whether or not they be notified before you sync with their NTP server. Admins who want to be notified are usually trying to manage the traffic to their server, so be sure and respect their wishes regarding notification. Note that primary servers are always considered as requesting notification before use.</li><li><strong>Service Area:</strong> If you've selected a primary or secondary server you want to use, click its hostname in the list to view further details for that server. Among the details listed is the <strong>ServiceArea</strong> field that describes the geographic or demographic group they intend to serve. If that field is <strong>Public</strong> then you do not have to be in a particular region to use the server. If they list a more specific service area, be sure to respect the server administrator's wishes in that regard.</li></ul><h3>Testing with ntpdate</h3><p>Before using an external NTP server to sync your time you should make sure you can actually connect to the server from your machine. Fortunately there's a tool for that included with the NTP server called <strong>ntpdate</strong>.</p><p>The ntpdate command will sync your clock with an NTP server. It's similar to what the NTP server does on a regular basis. The ntpd program is a separate package on Ubuntu and Debian. The other distributions install ntpdate at the time of ntpd installation. To use ntpdate, Ubuntu and Debian users must first install it.</p><pre>sudo aptitude install ntpdate
</pre><p>Set your clock to sync at times you specify by using cron to run ntpdate. Otherwise, run the NTP server as it uses less bandwidth and keeps time more accurately by tracking your clock's drift over time and adjusting accordingly. Use ntpdate for testing purposes only.</p><p>The ntpdate command will not run when the NTP server is running. If you run ntpdate and get a response like "the NTP socket is in use," this means your NTP server is running. Stop it with the appropriate command for your distribution:</p><h4>Ubuntu / Debian</h4><pre>sudo /etc/init.d/ntp stop
</pre><h4>CentOS / Fedora / RHEL / Gentoo</h4><pre>sudo /etc/init.d/ntpd stop
</pre><h4>Arch</h4><pre>sudo /etc/r.d/ntpd stop
</pre><p>You can now run ntpdate with the server you want to sync against as an argument. For example, to tell ntpdate to try and sync with "pool.ntp.org", run:</p><pre>sudo ntpdate pool.ntp.org
</pre><p>When you're finished testing, remember to restart NTP:</p><h4>Ubuntu / Debian</h4><pre>sudo /etc/init.d/ntp start
</pre><h4>CentOS / Fedora / RHEL / Gentoo</h4><pre>sudo /etc/init.d/ntpd start
</pre><h4>Arch</h4><pre>sudo /etc/rc.d/ntpd start
</pre><h3>Summary</h3><p>Fortunately, NTP time syncing is pretty easy to do. Once you've set the time servers and started the NTP service, it will do its work quietly in the background.</p><p>If NTP has any problems it will log them to the system log, which you should be checking regularly anyway.</p><p>For more details on setting up an NTP server and what options are available, visit the <a href="http://support.ntp.org/bin/view/Support/WebHome">NTP documentation site</a>. If you want to know more about how NTP works, go to the main <a href="&quot;http://www.ntp.org/">NTP web site</a> and all will be revealed.</p>
