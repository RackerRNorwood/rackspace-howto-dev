---
node_id: 108
title: Set up Apache virtual hosts on Ubuntu
permalink: article/ubuntu-apache-virtual-hosts
type: article
created_date: '2011-03-09 19:54:25'
created_by: RackKCAdmin
last_modified_date: '2015-11-06 15:5414'
last_modified_by: kyle.laffoon
products: Cloud Servers
categories: Uncategorized
body_format: tinymce
---

<p>Now that Apache is installed and running, you can configure it to serve multiple domains by using <em>virtual hosts</em>.</p>

<hr />
<table class="toc" id="toc" summary="Contents">
	<tbody>
		<tr>
			<td>
			<h2>Contents</h2>

			<ul>
				<li><a href="#Create_the_layout">Create the layout</a></li>
				<li><a href="#index.html">Create index.html</a></li>
				<li><a href="#Virtual_Hosts">Define virtual Hosts</a></li>
				<li><a href="#a2ensite">Enable the site</a></li>
				<li><a href="#Navigate">Navigate to the site</a></li>
				<li><a href="#ServerAlias">Use the ServerAlias</a></li>
				<li><a href="#Repeat_as_necessary">Repeat the process for the other domain</a></li>
				<li><a href="#Log_Files">View log files</a></li>
				<li><a href="#Default">Default vhost file</a></li>
				<li><a href="#Email">Set the admin email address</a></li>
				<li><a href="#Domain_Name">Set the domain name</a></li>
				<li><a href="#Index_Files">Define the index file</a></li>
				<li><a href="#Documents">Define the documents path</a></li>
				<li><a href="#Log_Files_2">Set the log files</a></li>
				<li><a href="#Error_Documents">Define error documents</a></li>
				<li><a href="#Apache_Footers">Define Apache footers</a></li>
				<li><a href="#cgi-bin">Enable cgi-bin</a></li>
				<li><a href="#Directory">Set directory options</a></li>
				<li><a href="#Summary">Summary</a></li>
			</ul>
			</td>
		</tr>
	</tbody>
</table>

<p>&nbsp;</p>

<p><a id="Create_the_layout" name="Create_the_layout"></a></p>

<h2>Create the layout</h2>

<p>This example uses two domains: domain1.com and domain2.com.</p>

<ol>
	<li>In your home directory, create a public_html folder:
	<pre>
cd ~
mkdir public_html
</pre>
	</li>
	<li>For each domain that you want to host, create a folder with a standard set of subfolders. The following commands create the folders public, private, log, cgi-bin, and backup for domain1.com and domain2.com:
	<pre>
mkdir -p public_html/domain1.com/{public,private,log,cgi-bin,backup}
mkdir -p public_html/domain2.com/{public,private,log,cgi-bin,backup}
</pre>
	</li>
</ol>

<p><a id="index.html" name="index.html"></a></p>

<h2>Create index.html</h2>

<p>The content of the public folder is up to you, but this example uses a very simple HTML file so that you can check the virtual host's work.</p>
<title></title>
<p>&nbsp;</p>

<ol>
	<li>For each domain, create an index.html file:
	<pre>
nano public_html/domain1.com/public/index.html</pre>
	</li>
	<li>Add the following code to the index.html file:
	<pre>
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;domain1.com&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;h1&gt;domain1.com&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
	</li>
	<li>Repeat the process so that you have a similar file for domain2.com. Replace all instances of <code>domain1.com</code> with <code>domain2.com</code>.</li>
</ol>

<p>&nbsp;</p>

<p><a id="Virtual_Hosts" name="Virtual_Hosts"></a></p>

<h2>Define virtual hosts</h2>

<p>Now you have a basic structure for your two domains, you can define two virtual hosts.</p>

<p><a id="NameVirtualHost" name="NameVirtualHost"></a></p>

<h3>Review NameVirtualHost</h3>

<p>With virtual hosts, the NameVirtualHost setting often causes confusion.</p>

<p>Each interface and port on which Apache is set to listen needs a NameVirtualHost directive. You can define the directive only once per port.</p>

<p>In the Apache layout for Ubuntu there is a default NameVirtualHost directive in the <code>ports.conf</code> file. If you've worked through the <a href="/knowledge_center/index.php/Ubuntu_Intrepid_-_Apache_configuration" title="Ubuntu Intrepid - Apache configuration">Ubuntu - Apache configuration</a> article, you might remember it being noted previously.</p>

<p>Run the following command to look at the contents of <code>ports.conf</code>:</p>

<pre>
cat /etc/apache2/ports.conf
</pre>

<p>You should get the following output (unless you've previously modified the file):</p>

<pre>
# If you just change the port or add more ports here, you will likely also
# have to change the VirtualHost statement in
# /etc/apache2/sites-enabled/000-default

NameVirtualHost *:80
Listen 80

&lt;IfModule mod_ssl.c&gt;
    # SSL name based virtual hosts are not yet supported, therefore no
    # NameVirtualHost statement here
    Listen 443
&lt;/IfModule&gt;
</pre>

<p>&nbsp;</p>

<p>The default NameVirtualHost setting satisfies the requirements at present â€” Apache will apply named based virtual host logic and settings for HTTP requests made on any available interface (*) at port 80.</p>

<p><strong>Note</strong>: The placement of the default NameVirtualHost directive in 'ports.conf' is new to Ubuntu's Apache layout; prior Ubuntu releases placed a similar setting in the default vhost.</p>

<p><a id="Custom_Virtual_Hosts" name="Custom_Virtual_Hosts"></a></p>

<h3>Define custom virtual hosts</h3>

<p>Now you are ready to add your own virtual hosts so that you can start to serve your domains.</p>

<p>Create the vhost file for domain1:</p>

<pre>
sudo nano /etc/apache2/sites-available/domain1.com.conf
</pre>

<p>The contents looks as follows:</p>

<pre>
# Place any notes or comments you have here
# It will make any customisation easier to understand in the weeks to come

# domain: domain1.com
# public: /home/demo/public_html/domain1.com/

&lt;VirtualHost *:80&gt;

  # Admin email, Server Name (domain name) and any aliases
  ServerAdmin webmaster@domain1.com
  ServerName  domain1.com
  ServerAlias www.domain1.com


  # Index file and Document Root (where the public files are located)
  DirectoryIndex index.html
  DocumentRoot /home/demo/public_html/domain1.com/public


  # Custom log file locations
  LogLevel warn
  ErrorLog /var/log/apache2/error-mydomainname.com.log
  CustomLog /var/log/apache2/access-mydomainname.com.log combined


</pre>

<p>&nbsp;</p>

<p><a id="a2ensite" name="a2ensite"></a></p>

<h2>Enable the site</h2>

<p>Enable the site as follows:</p>

<pre>
sudo a2ensite domain1.com
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The output of the command is as follows:</p>

<pre>
Site domain1.com installed; run /etc/init.d/apache2 reload to enable.
</pre>

<p>&nbsp;</p>

<p>Run the recommended command:</p>

<pre>
sudo /etc/init.d/apache2 reload
</pre>

<p>&nbsp;</p>

<p><a id="Navigate" name="Navigate"></a></p>

<h2>Navigate to the site</h2>

<p>To test the domain without creating a DNS zone and records on some Internet name servers, you can modify the '/etc/hosts' file on your local computer to include some entries mapping 'domain1.com', 'domain2.com', and the rest to the demo Cloud Server's public IP address:</p>

<pre>
127.0.0.1    localhost
...

# entries related to the demo Cloud Server
123.45.67.890   domain1.com
123.45.67.890   www.domain1.com
123.45.67.890   domain2.com
...
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The location of the 'hosts' file varies depending on what OS is loaded on your local computer.</p>

<p><strong>Note</strong>: Entries in the 'hosts' file must be removed prior to testing and using live DNS zones and records created on Internet name servers. Failure to remove them might lead to confusion on your part and inaccurate tests of new or modified public DNS records.</p>

<p>With such changes made for testing purposes, you can navigate to your site in a web browser on your local computer:</p>

<p><img alt="apache-vhostworking-domain1.jpg" border="2" src="http://articles.slicehost.com/assets/2008/12/5/apache-vhostworking-domain1.jpg" /></p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The contents of public/index.html file is shown.</p>

<p><a id="ServerAlias" name="ServerAlias"></a></p>

<h2>Use the ServerAlias</h2>

<p>Note that in the vhost file, you set a ServerAlias. If you have the DNS set up correctly, you can also use that address:</p>

<p><img alt="apache-vhostworking-wwwdomain1.jpg" border="2" src="http://articles.slicehost.com/assets/2008/12/5/apache-vhostworking-wwwdomain1.jpg" /></p>

<p>&nbsp;</p>

<p>We'll talk about forcing one address or the other in a later article about rewrite rules.</p>

<p><a id="Repeat_as_necessary" name="Repeat_as_necessary"></a></p>

<h2>Repeat the process for the other domain</h2>

<p>To create and enable domain2.com, repeat the process as follows:</p>

<ol>
	<li>Create the vhost file:
	<pre>
sudo nano /etc/apache2/sites-available/domain2.com
...
# Enter the details for domain2.com as per the example shown above

</pre>
	</li>
	<li>Enable the site and restart Apache:
	<pre>
sudo a2ensite domain2.com
...
sudo /etc/init.d/apache2 reload
</pre>
	</li>
	<li>Navigate to the second domain:
	<pre>
http://domain2.com
or
http://www.domain2.com
</pre>
	</li>
</ol>

<p>You should see the 'domain2.com' index file.</p>

<p><a id="Log_Files" name="Log_Files"></a></p>

<h2>View log files</h2>

<p>As defined in the vhosts file, each domain has its own log files.</p>

<p>List the logs for your domains:</p>

<pre>
ls /var/log/apache2/error-mydomainname.com.log
</pre>

<p>&nbsp;</p>

<p>The output is exactly as expected:</p>

<pre>
access.log  error.log
</pre>

<p>&nbsp;</p>

<p><a id="Default" name="Default"></a></p>

<h2>Default vhost file</h2>

<p>Although you changed the default virtual host, you did leave it in place.</p>

<p>If someone enters the IP address of the cloud server, they are served the contents of that default vhosts file (if you did not set up a separate vhost for the IP address).</p>

<p>Why are they served from that vhost file?</p>

<p>Apache searches the enabled vhost files in alphabetical order and if it can't find one for the requested IP address or domain name, it serves the first one (alphabetically).</p>

<p>If you had disabled or deleted the default vhost file, then the contents of domain1.com would be displayed (being before domain2.com alphabetically).</p>

<p>This is something to consider when planning your websites. Do you want a particular domain to be the default? Do you want the IP address to have completely different content?</p>

<p><a id="Email" name="Email"></a></p>

<h2>Set the admin email address</h2>

<p>Set the email address for the server administrator. This address is used if you set up the server to contact you when errors occur. It is also shown in the ServerSignature if its value is set to Email. (See the section, <a href="#Apache_Footers">Define Apache footers</a>.)</p>

<pre>
ServerAdmin webmaster@domain.com
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Domain_Name" name="Domain_Name"></a></p>

<h2>Set the domain name</h2>

<p>Set the domain name (ServerName) for the virtual host. You can have as many aliases (ServerAlias) as required. For example, you can have domain.com and domain.net point to the same content.</p>

<pre>
ServerName domain.com
ServerAlias www.domain.com
</pre>

<p>&nbsp;</p>

<p><strong>Note</strong>: This is not a rewrite rule, but the the domains defined here will serve the same content (assuming you have set the DNS to point to your Cloud Server IP).</p>

<p><a id="Index_Files" name="Index_Files"></a></p>

<h2>Define the index file</h2>

<p>Define the index file (the home page that is shown when the domain address is entered). This is useful if you have want the user to be directed to an alternate page or to a nonstandard home page.</p>

<pre>
DirectoryIndex index.html
</pre>

<p>&nbsp;</p>

<p><strong>Note</strong>: This is not a good method for redirecting users because they might go directly to a nonspecified page, such as domain.com/index.php, while the DirectoryIndex value works only for those entering domain.com.</p>

<p><a id="Documents" name="Documents"></a></p>

<h2>Define the documents path</h2>

<p>Define the location of the domain's public files. Use an absolute path name.</p>

<pre>
DocumentRoot /home/demo/public_html/domain.com/public
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Log_Files_2" name="Log_Files_2"></a></p>

<h2>Set the log files</h2>

<p>Set the log levels and the location for the virtual hosts' log files.</p>

<pre>
LogLevel warn
ErrorLog  /var/log/apache2/error-mydomainname.com.log
CustomLog /var/log/apache2/access-mydomainname.com.log combined
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Error_Documents" name="Error_Documents"></a></p>

<h2>Define error documents</h2>

<p>Set the ErrorDocument, which is used for all the standard error messages.</p>

<pre>
ErrorDocument 404 /errors/404.html
ErrorDocument 403 /errors/403.html
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>In this example, there is an 'errors' folder in the public directory. Each error document was created and placed in the errors folder. The paths shown are relative to the DocumentRoot folder defined previously.</p>

<p>If error messages are not defined, Apache generates its own error pages. Custom error pages are more user friendly and can be customized as much, or as little, as you want.</p>

<p><a id="Apache_Footers" name="Apache_Footers"></a></p>

<h2>Define Apache footers</h2>

<p>Define ServerSignature to specify whether the server details are displayed in any server-generated error pages or index lists. Options are On, Off, and Email.</p>

<pre>
ServerSignature On
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The level of detail in the signature is configured via ServerTokens, which cannot be set in the Virtual Hosts file. For Ubuntu's Apache layout, this is properly set in '/etc/apache2/conf.d/security'. See the Apache configuration #2 NEED LINK article for more details.</p>

<p>If ServerSignature is set to <strong>Email</strong>, the ServerAdmin email will be displayed.</p>

<p><a id="cgi-bin" name="cgi-bin"></a></p>

<h2>Enable cgi-bin</h2>

<p>Enable the cgi-bin location as defined by the custom virtual hosts layout. You can leave cgi-bin in the DocumentRoot location if you so want.</p>

<pre>
ScriptAlias /cgi-bin/ /home/demo/public_html/domain.com/cgi-bin/
&lt;Location /cgi-bin&gt;
  Options +ExecCGI
&lt;/Location&gt;
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Directory" name="Directory"></a></p>

<h2>Set directory options</h2>

<p>Set the options for the specified directory. The following example enables the FollowSymLinks option for the public directory of domain.com.</p>

<pre>
  Options FollowSymLinks
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>Following are other options that you can set:</p>

<p><a id="Directory_Browsing" name="Directory_Browsing"></a></p>

<h3>Directory browsing option</h3>

<p>To turn off directory browsing, use -Indexes. To turn on directory browsing, use +Indexes.</p>

<pre>
Options -Indexes
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="SSI" name="SSI"></a></p>

<h3>SSI option</h3>

<p>Enable or disable Server Side Includes. The following example disables it.</p>

<pre>
Options -Includes
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Symlinks" name="Symlinks"></a></p>

<h3>Symlinks option</h3>

<p>Enable or disable the option to follow symlinks. Be careful with this option because it can lead to security risks (inadvertently linking to configuration folders).</p>

<pre>
Options -FollowSymLinks
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>You can consider using the SymLinksIfOwnerMatch directive instead of FollowSymLinks. The SymLinksIfOwnerMatch directive allows symbolic links to be followed only if the owner of the link is identical to the owner of the target file or directory (in terms of Linux filesystem ownership/permissions). This prevents many of the security risks that a simple FollowSymlinks directive can create.</p>

<p><a id=".htaccess" name=".htaccess"></a></p>

<h3>.htaccess option</h3>

<p>Set AllowOverride to None to disable .htaccess support. Set it to All to allow support.</p>

<pre>
AllowOverride None
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>You can also specify which .htaccess features to enable, such as:</p>

<pre>
AllowOverride AuthConfig Indexes
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The Apache <a href="http://httpd.apache.org/docs/2.2/howto/htaccess.html" rel="nofollow" title="http://httpd.apache.org/docs/2.2/howto/htaccess.html">htaccess</a> and <a href="http://httpd.apache.org/docs/2.2/mod/core.html#allowoverride" rel="nofollow" title="http://httpd.apache.org/docs/2.2/mod/core.html#allowoverride">AllowOverride</a> docs have more information about the different features.</p>

<p>Remember to specifically protect your .htaccess file. You can do this by renaming it to something obscure and denying access access to the file from external sources:</p>

<pre>
AccessFileName .myobscurefilename
&lt;Files ~ "^\.my"&gt;
    &lt;SatisfyAll&gt;
    Require all denied
    &lt;/SatisfyAll&gt;
&lt;/Files&gt;
</pre>

<p>&nbsp;</p>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>&lt;SatisfyAll&gt; Require all denied&nbsp; &lt;/SatisfyAll&gt;&nbsp;</strong> with<strong> Order Allow,Deny | Deny from all | Satisfy all</strong>.</p>

<p><a id="No_Options" name="No_Options"></a></p>

<h3>No Options</h3>

<p>Specify None to turn off all the available options.</p>

<pre>
Options None
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a id="Hierarchy" name="Hierarchy"></a></p>

<h3>Options hierarchy</h3>

<p>The options directives can be set per directory, as shown in the following example:</p>

<pre>
  AllowOverride None
  Options None
  
AllowOverride All
</pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>The first directory setting would turn off all options and disable .htaccess support for all directories.</p>

<p>However, the second directory setting would override the first and allow .htaccess support for the domain.com/public directory.</p>

<p><a id="Summary" name="Summary"></a></p>

<h2>Summary</h2>

<p>The virtual hosts file is an easy tool to use but a very powerful one. We recommend that you enter one setting and then test it. Then enter the next setting and test, and so on.</p>

<p>After you become familiar with it, you will see you have fine control over all of your web folders and files.</p>
