---
node_id: 433
title: Connecting to a server using SSH on Linux or Mac OS
permalink: article/secure-shell-ssh
type: article
created_date: '2011-03-16 21:57:40'
created_by: RackKCAdmin
last_modified_date: '2014-08-08 16:0535'
last_modified_by: jered.heeschen
products: Cloud Servers
categories: SSH
body_format: tinymce
---

<p>This article provides the steps for connecting to your cloud server from a computer running Linux or Mac OS X by using SSH. It also discusses generating an SSH key and adding a public key to your server.</p>
<table id="toc" class="toc" summary="Contents">
<tbody>
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ol>
<li class="toclevel-1"><a href="#intro">Introduction</a></li>
<li class="toclevel-1"><a href="#Log_in">Log in</a></li>
<li class="toclevel-1"><a href="#SSH_keygen">Generate a new SSH key pair</a></li>
<li class="toclevel-1"><a href="#pubkey">Add the public key to your cloud account</a></li>
<li class="toclevel-1"><a href="#shortcut">Shortcut Configuration</a></li>
<li class="toclevel-1"><a href="#trouble">Troubleshooting</a></li>
</ol></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2><a id="intro"></a>Introduction</h2>
<p>Secure Shell (SSH) is a protocol through which you can access your cloud server and run shell commands. You can use SSH keys to identify trusted computers without the need for passwords, and to interact with your servers.</p>
<p>SSH is encrypted with <a title="SSL/TLS" href="/knowledge_center/index.php/SSL/TLS"> SSL</a>, which makes it difficult for these communications to be intercepted and read.</p>
<p><strong>Note:</strong> Many of the commands in this article must be run on your local computer. The default commands listed are for the Linux command line or Mac OS X Terminal. To make SSH connections from Windows, you can use a free program called <a href="/knowledge_center/index.php/Logging_in_via_Putty">PuTTY</a>. To generate keys, you can use a related program, <a href="/knowledge_center/index.php/SSH_-_PuTTYgen">PuTTYGen</a>. Use <a title="Securely Transfer Files With WinSCP" href="http://www.rackspace.com/knowledge_center/securely_transfer_files_with_winscp">WinSCP</a> to run SCP or SFTP on Windows.</p>
<h2 id="Log_in">Log in</h2>
<p>Using the IP address and password for your cloud server, log in by running the <code>ssh</code> command with <code>username@ipaddress</code> as the argument.</p>
<pre>ssh root@123.45.67.890</pre>
<p>You are prompted to enter the password for the account to which you're connecting.</p>
<h3>Remote host identification</h3>
<p>If you rebuilt your cloud server, you might get the following message:</p>
<pre>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</pre>
<p>One of the security features of SSH is that when you log in to a cloud server, the remote host has its own key that identifies it. When you try to connect, your SSH client checks the server's key against any keys that it has saved from previous connections to that IP address. When you rebuild a cloud server that remote host key changes, so your computer warns you of possibly suspicious activity.</p>
<p>To ensure the security of your server, you can <a title="Checking a server's ssh host key" href="http://www.rackspace.com/knowledge_center/2011/4/18/checking-a-server-s-ssh-host-fingerprint-with-the-web-console">use the web console in the Cloud Control Panel to verify your server's new key</a>. If you're confident that you aren't being spoofed, you can skip that step and delete the record of the old SSH host key as follows:</p>
<p>On your <em>local</em> computer, edit the SSH <code>known_hosts</code> file and remove any lines that start with your cloud server's IP address.</p>
<pre>nano ~/.ssh/known_hosts</pre>
<p>If you are not using Linux or Mac OS X on your local computer, the location of the <code>known_hosts</code> file might differ. Refer to your OS for information about the file location. PuTTY on Windows gives you the option of replacing the saved host key.</p>
<h2 id="SSH_keygen">Generate a new SSH key pair</h2>
<p>You can secure SSH access to your cloud server against brute force password attacks by using a public/private key pair. This means that a public key is placed on the server and a matching private key is placed on your local computer. If you <a href="/knowledge_center/article/rackspace-cloud-essentials-basic-cloud-server-security" target="_blank">configure SSH on your server to accept only connections using keys</a>, then no one else can log in using just a password. &nbsp;Connecting clients are required to use a private key that has a public key registered on the server.</p>
<ol>
<li>Run the following command using your email address as a label. Substitute your email address for <code>your_email@example.com</code> in the command.
<pre>ssh-keygen -t rsa -C "your_email@example.com"</pre>
<p>A message indicates that your public/private RSA key pair is being generated.</p>
<p>You are prompted to enter a file in which to save the key. Press <strong>Enter</strong> to use the default location.</p>
</li>
<li>If you want the additional security of a password for the key pair, enter a passphrase. If you don't want to use a password with the key pair, press <strong>Enter</strong> to continue without setting one.
<p>Your key pair is generated, and the output looks as follows:</p>
<pre>Your identification has been saved in /LocalFileLocation/id_rsa.
Your public key has been saved in /LocalFileLocation/id_rsa.pub.
The key fingerprint is: 01:0f:f4:3b:ca:85:d6:17:a1:7d:f0:68:9d:f0:a2:db your_email@example.com</pre>
</li>
<li>
<p>Optionally, add your new key to the local <code>ssh-agent</code> file to enable SSH find your key without the need to specify its location every time that you connect:</p>
<pre>ssh-add ~/.ssh/id_rsa</pre>
<p>You can use an SSH config shortcut instead of the <code>ssh-agent</code> file by following the instructions in the <a href="#shortcut">Shortcut configuration section</a> later in this article.</p>
</li>
</ol>
<h2 id="pubkey">Add the public key to your cloud account</h2>
<p>To make it easy to add your key to the new cloud servers you create, upload the public key to your cloud account by following these steps:</p>
<ol>
<li>Log in to the&nbsp;<a href="http://MyCloud.Rackspace.com">Cloud Control Panel</a>.</li>
<li>In the <strong>Servers</strong> section, click <strong>SSH Keys</strong>.</li>
<li>Click <strong>Add Public Key</strong>.</li>
<li>Enter a key name to remind you which computer this key is for; for example, <strong>Work Laptop</strong>.</li>
<li>Select the region for which you want to store the public key. To store your key in multiple regions, repeat these steps for each region.</li>
<li>Paste the contents of the <code>id_rsa.pub</code> file that you created into the <strong>Public Key</strong> field. You can get the file contents by either opening the file in a text editor or by running the following command:
<pre>cat ~/.ssh/id_rsa.pub</pre>
</li>
<li>Click <strong>Add Public Key</strong>.</li>
</ol>
<h3>Create a new server by using a stored key</h3>
<p>When you create a new Cloud Server, you can add a stored key to the new server.</p>
<p>In the <strong>SSH Key</strong> section of the server creation page, click the drop-down menu and select your key from the list. If you don't see a stored key in the list, you must switch the region for the new server to the region where you've stored the SSH key.</p>
<h2 id="SSH_Permissions">Add the key to an existing server</h2>
<p>You cannot use the Cloud Control Panel to add a public key to an existing server. Follow these steps to add the key manually:</p>
<ol>
<li>On your cloud server, create a directory named <code>.ssh</code> in the home folder of the account you will connect to via SSH.
<pre>mkdir -p ~/.ssh</pre>
</li>
<li>Create or edit the <code>authorized_keys</code> file and add your public key to the list of authorized keys.
<pre>nano ~/.ssh/authorized_keys</pre>
<p>A key is all on one line, so ensure that the key isn't broken by line breaks. You can have multiple keys in the <code>authorized_keys</code> file, with one key per line.</p>
</li>
<li>Set the correct permissions on the key.
<pre>chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys</pre>
</li>
</ol>
<p>With the public key added to the <code>authorized_keys</code>, you can make an SSH connection using your key pair instead of the account password.</p>
<h2 id="shortcut">Shortcut configuration</h2>
<p>You can set up a connection shortcut by creating a&nbsp;<code>~/.ssh/config</code> file on your local computer and adding your server and key details by using a text editor.</p>
<ol>
<li>Add the following text to the <code>~/.ssh/config</code> file, changing the values to match your server information:
<pre>Host <em>shortcutName</em>
HostName <em>serverAddressOrIPAddress</em>   
User <em>remoteUsername</em>
IdentityFile <em>/path/to/appropriate/ssh/rsa/private/key</em></pre>
<p>Each entry describes a feature of the server:</p>
<ul>
<li><strong>Host:</strong> A shortcut name you will use to tell SSH to use this connection</li>
<li><strong>HostName:</strong> The address of the server you will connect to</li>
<li><strong>User:</strong> The name of the user account to connect to on the server</li>
<li><strong>IdentityFile:</strong> The location of the private key file (id_rsa)</li>
</ul>
</li>
<li>After you set up the <code>config</code> file, connect to the server by using your shortcut name with SSH, as follows:
<pre>ssh <em>shortcutName</em></pre>
</li>
</ol>
<h2 id="trouble">Troubleshooting</h2>
<p>If you have trouble making a new connection after you restart the server, use the following steps to help you resolve the issue:</p>
<ul>
<li>If you get a <code>connection timeout</code> error, check the IP address that you used to ensure that it's correct. You might also check the server's iptables to ensure it isn't blocking the port used by SSH.</li>
<li>If you get a <code>connection refused</code> error, you might be trying to use SSH with the wrong port. If you changed your server to listen to a port other than 22, use the <code>-p</code> option with SSH to specify the port.</li>
<li>If you are getting a rejected login, then you might have an issue with your key. Change the sshd configuration to allow password connections by setting <code>PasswordAuthentication</code> to <code>yes</code>. Restart the server and try again. If you connect after these changes, then the issue is with the key and you must verify the key is in the right place on the server.</li>
<li>If all else fails, review your changes and restart the SSH daemon on the server by running the following command:
<pre>sudo service ssh restart</pre>
<p>If you get a message that the service SSH is unknown, run the command with <code>sshd</code> as the service name instead.</p>
</li>
</ul>
