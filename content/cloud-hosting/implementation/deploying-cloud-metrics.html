---
node_id: 4553
title: Deploying Rackspace Metrics
permalink: article/deploying-cloud-metrics
type: article
created_date: '2015-02-05 20:22:24'
created_by: constanze.kratel
last_modified_date: '2015-10-09 16:2329'
last_modified_by: constanze.kratel
products: Cloud Hosting
categories: Implementation
body_format: tinymce
---

<p>&nbsp;</p>

<p>To deploy the Rackspace Metrics service, you first need to complete the following steps:</p>

<p>Install the Blueflood Statsd backend engine</p>

<p>To install the Bllueflood Statsd backend engine, complete the following steps</p>

<p>Clone the statsd repository by typing the following at a command-line interface:</p>

<pre>
<code>git clone https://github.com/etsy/statsd.git
</code></pre>

<p>In a separate directory clone the blueflood statsd backend</p>

<pre>
<code>git clone git@github.com:tilogaat/blueflood-statsd-backend.git
</code></pre>

<p>Install nodejs.</p>

<pre>
<code>sudo apt-get install nodejs
</code></pre>

<p>If you are on Ubuntu, there may be another program called node. Make sure you purge it and then install nodejs</p>

<p>Install the node package manager program npm.</p>

<pre>
<code>sudo apt-get install npm
</code></pre>

<p>Now navigate to the statsd directory</p>

<pre>
<code>cd /path/to/statsd
</code></pre>

<p>Let's install the statsd backend using npm now.</p>

<pre>
<code>npm install /path/to/blueflood-statsd-backend
</code></pre>

<p>If all goes well, you should see the module under node_modules</p>

<pre>
<code>ls node_modules
</code></pre>

<p>Let us create a statsd config file called local.config and put the following into it. Assuming blueflood ingestion is running on 127.0.0.1 and port 19000 (Example config here: <a href="https://github.com/etsy/statsd/blob/master/exampleConfig.js">https://github.com/etsy/statsd/blob/master/exampleConfig.js</a>) Also, please set the deleteIdleStats flag to true, since the way Statsd sends us the 0d out values, is unexpected in some cases.</p>

<pre>
<code>{
    backends: ["statsd-blueflood-backend"],
    port: 8125,
    flushInterval: 10000,
    dumpMessages: true,
    deleteIdleStats: true,
    "blueflood": {
        "tenantId": "333333",
        "endpoint": "http://127.0.0.1:19000",
        "authModule": "./auth",
        "authClass": "RaxAuth",
        "authParams": {
                "raxusername": "my_cloud_user_name",
                "raxapikey": "my_rax_api_key"
        }
    }
}
</code></pre>

<p>Integrating with Rackspace Rackspace Metrics - Just add your Rackspace Username and Api Key to the config as shown. If the keys are present, the metrics will be sent to the Rackspace Metrics endpoint. If not, they will be sent to the endpoint in the configuration.</p>

<pre>
<code>"blueflood": {
  "tenantId": "333333",
  "endpoint": "http://iad.metrics-ingest.api.rackspacecloud.com:80",
  "authModule": "./auth",
  "authClass": "RaxAuth",
  "authParams": {
    "raxusername": "my_cloud_user_name",
    "raxapikey": "my_rax_api_key"
  }
}
</code></pre>

<p>Now, let us run statsd with the given config.</p>

<pre>
<code>nodejs stats.js local.config
</code></pre>

<p>Troubleshooting tip: If you see an error that the server cannot find the module "statsd-blueflood-backend", then do ls node_modules and see if that module</p>

<p>If all goes well, the nodejs statsd server should be up and running now.</p>

<pre>
<code>12 Sep 15:25:40 - reading config file: local.config
12 Sep 15:25:41 - server is up
</code></pre>

<p>To test: Statsd keeps generating stats about iself. These stats should be sent to Blueflood if the configuration is right</p>

<pre>
<code>{ counters: { 'statsd.bad_lines_seen': 0, 'statsd.packets_received': 0 },
  gauges: {},
  timers: {},
  timer_counters: {},
  sets: {},
  counter_rates: { 'statsd.bad_lines_seen': 0, 'statsd.packets_received': 0 },
  timer_data: {},
  pctThreshold: [ 90 ],
  histogram: undefined,
  statsd_metrics: { processing_time: 0 } }
</code></pre>

<p>You can also send statsd timers, counters, gauges as shown in the following link <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-statsd-to-collect-arbitrary-stats-for-graphite-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-configure-statsd-to-collect-arbitrary-stats-for-graphite-on-ubuntu-14-04</a> All these will be sent to BF</p>

<pre>
<code>echo "sample.gauge:10|g" | nc -u -w0 127.0.0.1 8125
echo "glork:320|ms" | nc -u -w0 127.0.0.1 8125
</code></pre>
