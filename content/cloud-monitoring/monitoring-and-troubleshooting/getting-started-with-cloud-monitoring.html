---
node_id: 1373
title: Getting Started With Rackspace Monitoring CLI
permalink: article/getting-started-with-cloud-monitoring
type: article
created_date: '2012-04-04 17:00:22'
created_by: RackKCAdmin
last_modified_date: '2014-06-17 13:4603'
last_modified_by: kyle.laffoon
products: Cloud Monitoring
categories: Monitoring and Troubleshooting
body_format: tinymce
---

<p>Cloud Monitoring is an API driven cloud service built for infrastructure monitoring.&nbsp; It offers a simple yet powerful feature-set, allowing extreme flexibility in configuration and execution. &nbsp;</p><p>This guide is intended to be a supplement to the <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/overview.html">official technical documentation</a>, not a replacement for it.&nbsp;</p><p>Getting started with an API-based monitoring system can be daunting when trying to rapidly scale infrastructure. To get your feet wet with the API, we have created <strong><em>Raxmon</em></strong>, a Command Line Interface (CLI) tool.</p><hr /><h2>Step One: Setup&nbsp;</h2><h4><br /> Install RaxmonCLI</h4><p>To avoid repeating the raxmon installation on each new Cloud Server, install it on your workstation and not your server.</p><p><strong>Note</strong>: raxmon requires Python 2.5, 2.6 or 2.7. Be sure that Python is installed before proceeding.</p><p>The Rackspace-Monitoring CLI tool is available here as open source: <a href="https://github.com/racker/rackspace-monitoring-cli">https://github.com/racker/rackspace-monitoring-cli</a></p><p>The utility can be installed via <a href="http://www.pip-installer.org/en/latest/installing.html">PIP</a>:</p><pre>sudo pip install rackspace-monitoring-cli</pre><h4>Getting your API Key</h4><p>You will need to <a href="http://www.rackspace.com/knowledge_center/article/rackspace-cloud-essentials-1-viewing-and-regenerating-your-api-key" target="_blank">get your API key</a> in order to be able to administer Cloud Monitoring.</p><p>Once you've obtained your API key, go to your Home folder (you can use <strong>cd ~/</strong>) and create a file named <strong>.raxrc</strong>, and add the following text:&nbsp;</p><pre>[credentials]
username=MY_USERNAME
api_key=MY_API_KEY</pre><p>An additional section is required in order to make use of the UK authentication endpoint (the default URL points to the US endpoint):&nbsp;</p><pre>[auth_api]
url=https://lon.identity.api.rackspacecloud.com/v2.0/tokens</pre><p>Now run raxmon to see that you can connect properly.</p><pre>$ raxmon-entities-list</pre><p>If the output includes a Trackback of most recent calls, Congratulations! It works!</p><hr /><h2>Step Two:&nbsp;Getting Familar</h2><p>Raxmon CLI has a variety of commands and abilities at its disposal. This section walks you through generating one of the most used checks, an HTTP check.</p><p>HTTP checks continually submit GET requests to your webpage and make sure that it responds and doesn't timeout or get connection refused, and triggers an alert if the response is something like a 404.</p><p>Raxmon mostly follows CRUD methodology, Create, Read (list), Update, Delete with five types:</p><ul><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-checks.html">Checks</a></li><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-entities.html">Entities</a></li><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-alarms.html">Alarms</a></li><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-notifications.html">Notifications</a></li><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-notification-plans.html">Notification Plans</a></li></ul><p>Type $ <strong>raxmon --help</strong> to see all of the commands available to raxmon.</p><p>You will need to update multiple items in one go, so let's review how to input lists and dictionaries in the terminal:</p><blockquote><p><strong>List</strong><br /> Use a comma delimited string. For example:<br /> raxmon-checks-create --monitoring-zones=mzA,mzB,mzC</p><p><strong>Dictionary</strong><br /> Use a comma delimited string of key=value pairs. For example<br /> raxmon-entities-create --metadata="location=server room,tag=foobar"</p></blockquote><hr /><h2>Step Three: Monitoring an HTTP Page&nbsp;</h2><h4>Create an Entity</h4><p><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-entities.html">Entities</a> are Cloud Monitoring's name for server-like objects. Anything that has an IP address is defined as an entity. Currently Cloud Monitoring has no concept of our environment, so lets create an entity.&nbsp;<span style="line-height: 1.538em;">The option&nbsp;</span><span style="line-height: 1.538em;">&nbsp;</span><span style="font-family: monospace;">--ip-addresses="alias=10.10.10.10"</span><span style="line-height: 1.538em;">&nbsp;</span><span style="line-height: 1.538em;">specifies the IP address and an alias for the target. You can have multiple targets per node.</span></p><pre>$ raxmon-entities-create --label my_first_server --ip-addresses="alias=10.10.10.10"<br />
Resource created. ID: entZ4JPIfA</pre><p>Now we need to create a <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-checks.html">check</a> . To create a check we'll need a few things.</p><ul><li>Check Type - In this case, <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-check-types.html#section-check-types-remote.http">remote.HTTP</a>.&nbsp;</li><li>A Label</li><li>Entity ID - In this case 'entZ4JPIfA' as returned in the example above</li><li><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-monitoring-zones.html">Monitoring Zone</a> - The data center we're going to monitor from</li><li>Target Alias -&nbsp;A key in the entity's 'ip_addresses' hash used to resolve this check to an IP address.</li><li>Any check specific details.</li></ul><p>We have all of these, except the <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-monitoring-zones.html">monitoring zone</a>. Lets grab that now.</p><pre>$ raxmon-monitoring-zones-list<br />
&lt;MonitoringZone: id=mzdfw label=dfw provider=Rackspace Monitoring ...&gt;
&lt;MonitoringZone: id=mzhkg label=hkg provider=Rackspace Monitoring ...&gt;
&lt;MonitoringZone: id=mzlon label=lon provider=Rackspace Monitoring ...&gt;
&lt;MonitoringZone: id=mzord label=ord provider=Rackspace Monitoring ...&gt;
Total: 4</pre><p>Now lets create that check. You'll use the Entity ID returned above, and the name of the Target Alias we created before.</p><pre>$ raxmon-checks-create --type remote.http --label http --entity-id entZ4JPIfA --monitoring-zones mzord --details="url=www.example.com,method=GET" --target-alias eth0<br />
Resource created. ID: chNbqDaZrJ</pre><h4>Notification Addresses and Alarms</h4><p>Checks are great, but you also need to be able to receive <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-notifications.html">notifications</a>. Lets create an e-mail address notification type now.</p><pre>$ raxmon-notifications-create --label example-email --type email --details="address=user@email.com"
Resource created. ID: ntYgMnnipC</pre><p>You also need to create a <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-notification-plans.html">notification plan</a>. This allows cloud monitoring to emit different types of alerts on different states.&nbsp;</p><pre>$ raxmon-notification-plans-create --label notification_plan_1 --critical-state ntYgMnnipC --warning-state ntYgMnnipC --ok-state ntYgMnnipC
Resource created. ID: npzwIZKV6o</pre><p>Notifications are ONLY emitted when state changes. When a plan moves from OK state to Critical state, it will notify the "Critical State Notification." When it then changes from Critical to OK the "OK State Notification" will be used.</p><p>Now that you have a notification address and plan, you also need to create the <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/service-alarms.html">alarm</a> itself.&nbsp;Rackspace Cloud Monitoring uses alarms to evaluate the metrics of a check and decide if a notification plan should be executed.</p><pre>$ raxmon-alarms-create --check-id=chNbqDaZrJ --criteria "if (metric[\"code\"] regex \"^[23]..$\") { return OK } return WARNING" --notification-plan npzwIZKV6o --entity-id entZ4JPIfA</pre><p>Great! That's it. You now have a check, notification, and alarm. Lets look at the details:</p><pre>raxmon-alarms-list --entity&nbsp;entZ4JPIfA&nbsp;--details
{'criteria': u'if (metric["code"] regex "^[23]..$") { return OK } return WARNING', 'driver': &lt;rackspace_monitoring.drivers.rackspace.RackspaceMonitoringDriver object at 0x101d66710&gt;, 'entity_id': u'entZ4JPIfA', 'id': u'albuOSvLjf', 'notification_plan_id': u'npzwIZKV6o','type': u'remote.http'}</pre><p>Now&nbsp;anything but a 2XX or 3XX will return an&nbsp;error and&nbsp;you will be notified via e-mail.&nbsp;</p><h2>Conclusion</h2><p>With these simple principles,&nbsp;you'll be able to create a robust and scalable monitoring system that gives you better insight into your&nbsp;infrastructure. &nbsp;For more information, be sure to consult the <a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/overview.html" target="_blank">Development Guide for Cloud Monitoring</a> as well as the <a href="http://www.rackspace.com/knowledge_center/product-faq/cloud-monitoring" target="_blank">Cloud Monitoring FAQ</a>.</p>
