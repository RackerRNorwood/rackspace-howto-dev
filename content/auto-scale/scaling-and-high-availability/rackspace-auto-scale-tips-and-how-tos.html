---
node_id: 3849
title: "Rackspace Auto Scale tips and how-to's"
permalink: article/rackspace-auto-scale-tips-and-how-tos
type: article
created_date: '2014-01-14 00:05:47'
created_by: maria.abrahms
last_modified_date: '2015-11-11 17:0717'
last_modified_by: stephanie.fillmon
products: Auto Scale
categories: Scaling and High Availability
body_format: tinymce
---

<p>Read the following tips and how-to sections to help you achieve your goals with Rackspace Auto Scale.</p>

<ul>
	<li><a href="#ASandNova" target="_self">How Auto Scale works</a></li>
	<li><a href="#InvalidPreventScaling" target="_self">Invalid load balancers can prevent scaling</a></li>
	<li><a href="#DeleteScalingGroupsMissingServers" target="_self">Deleting&nbsp;scaling groups with missing servers</a></li>
	<li><a href="#serviceNet">ServiceNet dependency can cause server creation to fail</a></li>
	<li><a href="#ConnectSingleCloudMonitoring" target="_self">Connecting Auto Scale to a single Cloud Monitoring alarm</a></li>
	<li><a href="#AddRemoveServers" target="_self">Adding or removing&nbsp;servers quickly</a>&nbsp;</li>
	<li><a href="#MaxandMinEntities" target="_self">maxEntities and minEntities settings affect scaling</a></li>
	<li><a href="#CreateandUpdate" target="_self">Creating&nbsp;and updating&nbsp;the launchConfiguration setting</a>
	<ul>
		<li><a href="#CreateScalingGroup" target="_self">Create a scaling group with the launchConfiguration setting</a></li>
		<li><a href="#UpdateLaunchSuccess" target="_self">Update the launchConfiguration setting successfully</a></li>
		<li><a href="#UpdateLaunchEviction" target="_self">Update the launchConfiguration eviction policy</a></li>
	</ul>
	</li>
	<li><a href="#DeletingServers" target="_self">Deleting servers</a>
	<ul>
		<li><a href="#AboutActiveServers" target="_self">About the server "Active" state when deleting servers</a></li>
		<li><a href="#DeletingServerFromGroup" target="_self">Delete a specific server from a scaling group</a></li>
	</ul>
	</li>
	<li><a href="#ChooseFlavor" target="_self">Choosing&nbsp;the flavor&nbsp;of a server for a scaling group</a></li>
	<li><a href="#cloudBurst">Cloud Bursting with Auto Scale and RackConnect V3</a></li>
	<li><a href="#changePerfServerSize">Using&nbsp;Auto Scale to change the size of your&nbsp;General Purpose or work-optimized&nbsp;server</a></li>
</ul>

<h2><a id="ASandNova" name="ASandNova"></a>How&nbsp;Auto Scale works</h2>

<p>Rackspace Auto Scale is written in Python and calls the Rackspace Cloud Servers, Rackspace Cloud Load Balancers, and Rackspace RackConnect v3 APIs.&nbsp;All Rackspace Cloud Server <strong>create server</strong> configuration parameters can be used with Auto Scale. For more information, see the&nbsp;<a href="http://docs.rackspace.com/">Rackspace Cloud Servers documentation</a>. For technical details, see the public <a href="https://github.com/rackerlabs/otter/tree/master/doc">Auto Scale GitHub documentation</a> and the public <a href="https://github.com/rackerlabs/otter/wiki">Auto Scale GitHub Wiki</a>.</p>

<h2><a id="InvalidPreventScaling" name="InvalidPreventScaling"></a>Invalid load balancers can prevent scaling</h2>

<p>If you create a scaling group with more than one load balancer and one of the load balancers is invalid (bad configuration), the scaling group never scales. Auto Scale goes through the following process:</p>

<ol>
	<li>Creates servers</li>
	<li>Tries to add them to the load balancers</li>
	<li>Discovers that one of the load balancers is invalid</li>
	<li>Deletes the servers</li>
	<li>Removes the node from the valid load balancers.&nbsp;</li>
</ol>

<h2><a id="DeleteScalingGroupsMissingServers" name="DeleteScalingGroupsMissingServers"></a>Deleting&nbsp;scaling groups with missing servers</h2>

<p>If you have manually deleted servers outside of Auto Scale, or you want to delete a scaling group without using the&nbsp;<strong>force delete</strong>&nbsp;option provided in the API, and you have existing servers in the group, perform the following actions:</p>

<ol>
	<li>Update both the&nbsp;<strong>minEntities</strong>&nbsp;and <strong>maxEntities</strong>&nbsp;values to&nbsp;<strong>0.</strong></li>
	<li>Delete&nbsp;the group.</li>
</ol>

<p>The following example illustrates those steps:</p>

<pre>
PUT&nbsp;v1.0/<em>tenantId</em>/groups/<em>groupId</em>/config
{"maxEntities": 0, "cooldown": 0, "name": "ready_to_be_deleted", "minEntities": 0, "metadata": {}}
DELETE&nbsp;v1.0/{tenantId}/groups/{groupId}</pre>

<h2><a name="serviceNet"></a>ServiceNet dependency can cause server creation to fail</h2>

<p>When you configure your Auto Scale scaling group with a load balancer, you need to include the Rackspace&nbsp;ServiceNet&nbsp;network as part of the launch configuration. You cannot have only a private network in the launch configuration.</p>

<p>In a scale-up operation, Auto Scale tries to retrieve the&nbsp;ServiceNet&nbsp;IP address of the server that it builds to add it to the load balancer. If&nbsp;ServiceNet&nbsp;is not part of the configuration, this action fails. To recover from this failure, Auto Scale deletes the server that it built, which results in no active servers.</p>

<p>You can avoid this problem by adding&nbsp;ServiceNet&nbsp;to the&nbsp;list of networks for the Auto Scale group. In the future, Auto Scale will validate that&nbsp;the ServiceNet&nbsp;network is part of the launch configuration if a load balancer is configured.</p>

<h2><a id="ConnectSingleCloudMonitoring" name="ConnectSingleCloudMonitoring"></a>Connecting Auto Scale to a single Cloud Monitoring alarm</h2>

<p>This tip shows you how to use a webhook to trigger an Auto Scale policy. It does not explain how to create a check or an Auto Scale group. &nbsp;For information about creating checks and alarms, see the <em><a href="http://docs.rackspace.com/cm/api/v1.0/cm-devguide/content/overview.html">Cloud Monitoring Developerâ€™s Guide</a></em> or the&nbsp;<a href="/knowledge_center/article/rackspace-cloud-monitoring-checks-and-alarms">Cloud Monitoring Checks and Alarms</a> documentation in the Knowledge Center.</p>

<p>Modify the example values used for the configurations to meet your needs. These values use the Auto Scale API to first create a webhook policy with a desired capacity of 5 servers and a cooldown of 3 minutes, and then create a webhook named Cloud Monitoring. In steps 3, 4, and 5, you use the Cloud Monitoring API to create a notification by using the webhook URL created in step 2, a notification plan by using the webhook ID created in step 3, and an alarm that uses the notification plan created in step 4. All of these steps, except creating the webhook, can be done through the <a href="https://intelligence.rackspace.com/">Cloud Intelligence</a> UI.&nbsp;</p>

<ol>
	<li>
	<p>Create a webhook policy.</p>

	<pre>
POST/autoscale: v1.0//groups//policies
[
{
"name": "set group to 5 servers",
"desiredCapacity": 5,
"cooldown": 1800,
"type": "webhook"
}
}</pre>
	</li>
	<li>
	<p>Create a webhook for Cloud Monitoring&nbsp;under the webhook policy.</p>

	<pre>
POST/autoscale: v1.0//groups/policies//webhooks
[
{
"metadata": {},
"name": "Cloud Monitoring"
}
]</pre>
	</li>
	<li>
	<p>Create a Cloud Monitoring notification</p>

	<pre>
POST/monitoring: /notifications
{
"label": "AutoScale",
"type": "webhook",
"details": {
"url": &lt;webhook_URL_from_AutoScale&gt;
}
}</pre>
	</li>
	<li>
	<p>Create a Cloud Monitoring notification plan.</p>

	<pre>
POST/monitoring: /notification_plans
{
"label": "Notification Plan 1",
"critical_state": [
&lt;notification_ID_from_AutoScale&gt;"
],

"warning_state": [
],
}
"ok_state": [
]
}</pre>
	</li>
	<li>
	<p>Create an alarm in Cloud Monitoring.</p>

	<pre>
POST/monitoring: /entities//alarms
'{
"check_id": "&lt;check_you_want_to_use&gt;",
"criteria": "&lt;criteria_you_want_to_use&gt;",
"notification_plan_id": "&lt;notification_plan_you_just_created&gt;"
}</pre>
	</li>
</ol>

<h2><a name="AddRemoveServers"></a>Adding or removing&nbsp;servers quickly</h2>

<p>To quickly add servers to or remove servers from a scaling group, send a request to change the value of the <strong>minEntities</strong> or <strong>maxEntities</strong> parameter, as documented in the <a href="https://developer.rackspace.com/docs/autoscale/v1/developer-guide/#update-scaling-group-configuration">Update scaling group configuration</a> section of the&nbsp;<em>Rackspace Auto Scale API Developer</em>&nbsp;<em>Guide.</em>&nbsp;</p>

<p>Following is an example request:</p>

<pre>
PUT //groups//config 
{ "name": "workers",
"cooldown": 60,
"minEntities": 5,
"maxEntities": 100,
"metadata": {
"firstkey": "this is a string",
"secondkey": "1", }
}</pre>

<p>You can remove a specific server from a scaling group by using the delete server operation. For more information, see the <a href="https://developer.rackspace.com/docs/autoscale/v1/developer-guide/#delete-server-from-scaling-group">Delete server from scaling group</a> section of the&nbsp;<em>Rackspace Auto Scale API Developer&nbsp;Guide.</em></p>

<h2><a id="MaxandMinEntities" name="MaxandMinEntities"></a>maxEntities and minEntities settings affect scaling</h2>

<p>If the number of active servers (desired capacity) in a scaling group is equal to the configured <strong>maxEntities</strong>&nbsp;value during a scale-up, or equal to the configured&nbsp;<strong>minEntities</strong>&nbsp;value during a scale-down, the call to execute the scaling policy returns a <code>400 Bad Request</code> error response code with the message <code>No change in servers</code>.</p>

<p>If the number of active servers in a scaling group is less than the&nbsp;<strong>maxEntities</strong>&nbsp;value, the call to execute a scale-up policy returns a <code>200 OK</code> response code and increases the number of servers to the&nbsp;<strong>maxEntities</strong>&nbsp;value or the amount specified.</p>

<p>If the number of active servers in a scaling group is greater than the&nbsp;<strong>minEntities</strong>&nbsp;value, the call to execute a scale-down policy returns a <code>200 OK</code> response code and reduces the number of servers to the&nbsp;<strong>minEntities</strong>&nbsp;value or the amount specified.</p>

<p><strong>Note</strong>: You can change the <strong>minEntities</strong> and <strong>maxEntities</strong>&nbsp;values for a scaling group by using the <a href="https://mycloud.rackspace.com/">Cloud Control Panel</a>. To do this, select <strong>Auto Scale</strong> from the <strong>Servers</strong> menu, select the scaling group, and then,&nbsp;from&nbsp;the <strong>Actions</strong> menu, select&nbsp;<strong>Edit Min / Max Servers</strong>.&nbsp;</p>

<h2><a id="CreateandUpdate" name="CreateandUpdate"></a>Creating&nbsp;and updating&nbsp;the launch configuration setting</h2>

<p>All Auto Scale API update requests completely replace all of the settings of the item being updated. Any&nbsp;parameters that are not specified in the update request&nbsp;are reset to null or to the default value. All requests, except update launch configuration operation, validate that all required fields are provided.&nbsp;A&nbsp;failed launch configuration&nbsp;update returns a <code>400 error response</code> code. The following examples show how to create and update a launch configuration&nbsp;setting. Creating uses a POST operation, updating uses a PUT operation.</p>

<p><strong>Note</strong>: Each user can have multiple SSH key pairs (name and key). The launch configuration uses the admin userâ€™s SSH key pair name, usually the first admin user found in the tenant. If there are multiple admin accounts in the tenant, there is no guarantee as to which one is used. So it is best for there to be&nbsp;one admin user in the tenant. This restriction cannot be changed currently. There is no option to specify a user to impersonate.&nbsp;</p>

<h3><a id="CreateScalingGroup" name="CreateScalingGroup"></a>Create a scaling group with the launch configuration setting</h3>

<p>This example creates a scaling group with load balancers, server metadata, networks, and personality.</p>

<pre>
POST /&lt;tenant_id&gt;/groups
{
"launchConfiguration": {
"args": {
"loadBalancers": [
{
"port": 8080,
"loadBalancerId": 9099
}
],
"server": {
"name": "autoscale_server",
"imageRef": "0d589460-f177-4b0f-81c1-8ab8903ac7d8",
"flavorRef":&nbsp;"performance1-2",
OS-DCF:diskConfig":&nbsp;"AUTO",
"metadata": {
"build_config": "core",
"meta_key_1": "meta_value_1",
"meta_key_2": "meta_value_2"
},
"networks": [
{
"uuid":&nbsp;"11111111-1111-1111-1111-111111111111"
},
],
"uuid":&nbsp;"00000000-0000-0000-0000-000000000000"
"personality": [
{
"path": "/root/.csivh",
"contents": "VGhpcyBpcyBhIHRlc3QgZmlsZS4="
}
]
}
},
"type": "launch_server"
},
"groupConfiguration": {
"maxEntities": 10,
"cooldown": 360,
"name": "testscalinggroup198547",
"minEntities": 0,
"metadata": {
"gc_meta_key_2": "gc_meta_value_2",
"gc_meta_key_1": "gc_meta_value_1"
}
},
"scalingPolicies": [
{
"cooldown": 0,
"type": "webhook",
"name": "scale up by 1",
&lt;"change": 1
}
]
}</pre>

<h3><a id="UpdateLaunchSuccess" name="UpdateLaunchSuccess"></a>Update the launch configuration setting successfully</h3>

<p>This example shows updating only the <strong>flavorRef</strong> and <strong>name</strong> parameters without the remaining fields, and a successful 204 response code. Note&nbsp;that <span>the update operation ov</span><span>erwrites all launch configuration parameters. A</span>ny&nbsp;parameters not&nbsp;specified in the update&nbsp;are reset to null or the default value.</p>

<pre>
PUT /&lt;tenant_id&gt;/groups/&lt;group_id&gt;/launch
{&lt;
"type": "launch_server",
"args": {
"server": {
"flavorRef": performance1-4,
"name": "update_launch_config",
"imageRef": "0d589460-f177-4b0f-81c1-8ab8903ac7d8"
}}</pre>

<p>Retrieve the launch configuration response. The load balancers, server's metadata, personality, and networks are overwritten because of the preceding update.&nbsp;</p>

<pre>
GET /{tenant_id}/groups/{group_id}/launch (The load balancers, server's metadata, personality, and networks, are overwritten due to no load balancer, server metadata, personality, or networks, parameters being included in the update request)
{
"type": "launch_server",
"args": {
"server": {
"flavorRef": performance1-4,
"name": "update_launch_config",
"imageRef": "0d589460-f177-4b0f-81c1-8ab8903ac7d8"
}}}</pre>

<h3><a id="UpdateLaunchEviction" name="UpdateLaunchEviction"></a>Update the launch configuration eviction policy</h3>

<p>When a launch configuration setting is updated, the servers that scale up after the update use the latest launch configuration settings.</p>

<p>A scale-down that occurs after the launch configuration setting has been updated&nbsp;first deletes servers with the older launch configuration setting. The only exception to this is when servers are building. Auto Scale attempts to first delete servers being built (pending) in a scale-down policy execution, then servers with the older launch configuration setting, and lastly any other servers required by the scale-down policy.&nbsp;</p>

<h2><a id="DeletingServers" name="DeletingServers"></a>Deleting servers</h2>

<p>Deleting servers requires an Auto Scale Python call to the Rackspace Cloud Servers Nova-based API, and there are a few things about this process that it is good to understand. Additionally, new functionality has been added to allow you to delete a specific server from a scaling group. These topics are discussed in this section.</p>

<h3><a id="AboutActiveServers" name="AboutActiveServers"></a>About the server "Active" state when deleting servers</h3>

<p>When a scale-down policy is being executed, servers in the <strong>Active</strong> state are deleted immediately because Nova, the software behind&nbsp;Rackspace Cloud Servers, is aware of those servers. Auto Scale issues deletes for Pending&nbsp;servers first, but Nova executes deletes for Active&nbsp;servers first. This is why, for a time, you might see servers in the Control Panel that you have deleted; the inter-programming communication and executions cause a lag.&nbsp;For example, if a scale-up policy is executing to build five servers and, while the servers are still building, a scale-down policy executes to scale down by two servers, you might see five servers in the Control Panel until they are all done building and go into the Active&nbsp;state, immediately after which two servers will be deleted.</p>

<h3><a id="DeletingServerFromGroup" name="DeletingServerFromGroup"></a>Delete&nbsp;a specific server from a scaling group</h3>

<p>You can remove a specific server from a scaling group by using the delete server operation. For more information, see the <a href="https://developer.rackspace.com/docs/autoscale/v1/developer-guide/#delete-server-from-scaling-group">Delete server from scaling group</a> section&nbsp;<em>Rackspace Auto Scale API Developer&nbsp;Guide.</em></p>

<h2><a id="ChooseFlavor" name="ChooseFlavor"></a>Choosing&nbsp;the flavor&nbsp;of a server for a scaling group</h2>

<p>If you create an image of a server&nbsp;and use that image to create a scaling group, you must choose a flavor in the scaling group that is equal to, or greater than, the capacity of the flavor of the server from which the image was created.&nbsp;For more information about available server flavors, see <a href="http://docs.rackspace.com/servers/api/v2/cs-devguide/content/List_Flavors-d1e4188.html">Flavors</a> in the Cloud Servers API documentation.</p>

<h2><a id="cloudBurst" name="cloudBurst"></a>Cloud bursting with Auto Scale and RackConnect</h2>

<p>Auto Scale and RackConnect allow bursting into the public cloud from events in a dedicated environment. RackConnect is provisioned by setting a metadata flag for a RackConnect group in the Auto Scale&nbsp;launch configuration <code>metadata</code> section (see the following example). When that section is set properly, and Auto Scale scales up a group, the new server will be modified by RackConnect to have its public interface disabled and will begin receiving Private Cloud traffic from the RackConnect load balancer. The following KC article describes this process in detail: <a href="https://admin.rackspace.com/knowledge_center/article/cloud-bursting-using-auto-scale-rackconnect-and-f5-load-balancers">Cloud Bursting using Auto Scale RackConnect and F5 Load Balancers</a>.</p>

<p>Example RackConnect metadata key and&nbsp;value pair for Auto Scale:</p>

<pre>
"metadata": { 
"RackConnectLBPool": "MyRCPoolName"
}
</pre>

<h2><a id="changePerfServerSize" name="changePerfServerSize"></a>Using&nbsp;Auto Scale to change the size of your General Purpose or work-optimized&nbsp;server</h2>

<p>General Purpose and work-optimized servers&nbsp;do not resize as simply as first-generation and Standard servers. You have to go through a process to resize, detailed in&nbsp;<a href="/knowledge_center/article/changing-the-size-of-your-general-purpose-or-optimized-cloud-server">Upgrading resources for General Purpose or I/O optimized Cloud Servers</a>,&nbsp;in order to resize, and your server does not keep its&nbsp;IP address. You can use Auto Scale to&nbsp;accomplish server resizing, keeping your IP address, and have it happen dynamically in response to load. You pay for the higher-flavor servers (for example, General Purpose and work-optimized)&nbsp;only when you need them, and when you don't need them, you can scale back down to lower-flavor servers (for example, first-generation and Standard)â€”or keep the higher-flavor servers and just scale back how many servers are in your group.</p>

<p>When&nbsp;you're&nbsp;ready to set up your&nbsp;scaling system to resize servers dynamically, use the following guidelines.</p>

<ol>
	<li>
	<p>Create two scaling groups:&nbsp;one with a lower flavor for the server setting in the <strong>launchConfiguration</strong> option, and another with higher&nbsp;flavor server setting in the <strong>launchConfiguration</strong> option. Configure both scaling groups with same image and load balancer.&nbsp;</p>
	</li>
	<li>
	<p>Create two policies for each scaling group:&nbsp;</p>

	<p>â—¦ &nbsp; One policy with <strong>desiredCapacity</strong>=0</p>

	<p>â—¦ &nbsp; One with <strong>desiredCapacity</strong>=2 or 3 &nbsp;(that is,&nbsp;scale up by 2 or 3)</p>
	</li>
</ol>

<p>When you want a higher-flavor server, execute the scale-up policy on with the higher-flavor scaling group and the <strong>desiredCapacity=0</strong> policy on the lower-flavor group. Do the opposite when switching from a higher flavor to a lower flavor. &nbsp;</p>

<p>This technique works well for single-server deployments. In fact, for smaller deployments, the scale-up policy might just be +1 instead of 2 or 3.&nbsp;</p>

<p>One disadvantage of this technique is being charged for a load balancer when you don't really need it. However, that cost should be offset by the scaling down, using lower-flavor (and less expensive) servers when the load is lighter.&nbsp;</p>
