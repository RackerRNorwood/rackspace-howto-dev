---
node_id: 4560
title: Rackspace CDN edge rules
permalink: article/rackspace-cdn-edge-rules
type: article
created_date: '2015-02-11 23:11:37'
created_by: megan.meza
last_modified_date: '2015-10-06 16:0603'
last_modified_by: catherine.richardson
products: Rackspace CDN
categories: Content Delivery Network
body_format: tinymce
---

<p>Rackspace CDN [<a href="http://www.rackspace.com/cloud/cdn-content-delivery-network">product page</a>] enables you to create rules for content served over the content delivery network (or CDN). You create the rules after you <a href="http://www.rackspace.com/knowledge_center/article/create-a-cdn-service-with-rackspace-cdn">create the Rackspace CDN service</a>. Edge rules are a set of policies that tell the CDN how to handle your traffic. They are called "edge rules" because these policies are applied at the edge, meaning that you don't need logic on your web server to enforce this behavior. Rackspace currently supports three types of edge rules:&nbsp; caching rules, origin rules, and restrictions. Each of these rule types is covered in more detail below.&nbsp;&nbsp;</p>

<ul>
	<li><a href="#order">Caching rules</a></li>
	<li><a href="#examples">Origin rules</a></li>
	<li><a href="#restrictions">Restrictions</a></li>
	<li><a href="#Rule set up">Rule set up</a><br />
	&nbsp;</li>
</ul>

<h2><a id="order" name="order"></a>Caching rules</h2>

<p>Caching rules control the TTL for your site's content. Setting the TTL for content tells the edge servers how long to cache content before checking the origin (the web server) for a fresh copy of the content. We recommend using low TTL for content that changes frequently and a higher TTL (for example, 24 hours) for more static content, like images.</p>

<p>For example: a user sets a TTL of three hours for some content that she updates every hour. The edge server serves the content from a cache for the three hour period without communicating with the origin server. When the user updates the content, the updates are not seen by her website visitors until the end of the three-hour period.&nbsp;</p>

<p><strong>Warning:</strong>&nbsp;If your site has dynamic content or uses cookies to alter the experience per visitor, set that content's TTL to 0 (zero) seconds. You can still give your static content the higher TTL while setting the rest of your content's TTL to 0. For sites with dynamic content, your rules might be set up as follows:</p>

<p><img alt="" border="2" height="192" src="/knowledge_center/sites/default/files/field/image/CachingRulesExample_2_0.png" width="683" /></p>

<p><strong>Note:</strong>&nbsp; If no TTL is set, Rackspace CDN sets default TTL values for your content as follows:</p>

<ul>
	<li>Error responses are cached for 10 seconds.</li>
	<li>Cache redirect responses are not cached.</li>
	<li>If you do not set up any caching rules, all content is cached for 1 day.</li>
</ul>

<p>&nbsp;</p>

<h2><a id="examples" name="examples"></a>Origin rules</h2>

<p>Origin rules are used when you need to pull content from two or more origins (web servers, load balancers, etc) for the same CDN service. &nbsp;For example, all&nbsp;your&nbsp;images may be stored in a Cloud Block Storage volume attached to one server, while your web code lives on another server. &nbsp;You must create an origin rule in order to add an origin to an existing CDN Service. &nbsp;In other words, you cannot create an additional origin for a service without telling the CDN when to route to that origin. &nbsp;</p>

<p>Default caching rules listed above apply to all origins.</p>

<p>To setup a new origin, begin by clicking on the <strong>Add Origin</strong> link on the Details page for your CDN service. &nbsp;Get started with your origin rule for your new origin by&nbsp;giving an IP or domain for that origin.</p>

<p><img alt="" border="2" height="181" src="/knowledge_center/sites/default/files/field/image/Screen%20Shot%202015-10-02%20at%201.43.49%20PM.png" width="435" /><br />
&nbsp;</p>

<p><strong>Tip</strong>: &nbsp;Rackspace recommends that customers use domains to identify their origins when possible, as IP addresses can change over time. &nbsp;When entering your IP address or origin domain, you do NOT need to enter <strong>http://</strong>.</p>

<p>Once you have identified your new origin, you must tell the service when you want to fetch content from that origin. &nbsp;This can be done by specifying a content path. &nbsp;For example, if you want all of your images requested from the new origin, you will set the path to <strong>/images/*</strong>. &nbsp;With this rule, any time your your domain gets a&nbsp;request&nbsp;that contains "/images/" in the path, the CDN will fetch that&nbsp;content from your new origin if it can't be&nbsp;found&nbsp;on the edge. &nbsp;</p>

<p><strong>Tip</strong>: When using a path to set rules, a wildcard is necessary. &nbsp;For example, <strong>/images/</strong> is not a valid path, but <strong>/images/*</strong> is a valid path. &nbsp;<br />
<br />
<strong>Warning</strong>: &nbsp;When adding origins to a service, you should always check that your origin can accept traffic from the domain listed in your CDN Service. For example, if your CDN service has a domain of cdn.customer1.com, you may need to alter your server's .htaccess file to allow traffic for that domain. &nbsp;</p>

<p><strong>Note: </strong>Requests are passed to the origin using the original hostname in the header. If your CDN domain is <a href="http://cdn.mysite.com" rel="nofollow">cdn.mysite.com</a> and the origin is <a href="http://mysite.com" rel="nofollow">mysite.com</a>, you might expect that the CDN would change the hostname to <a href="http://mysite.com" rel="nofollow">mysite.com</a> when fetching from the origin. However, that is not the case.</p>

<p>&nbsp;</p>

<h2><a id="restrictions" name="restrictions"></a>Restrictions</h2>

<p>Rackspace CDN enables you to specify restrictions based the following:</p>

<ul>
	<li>Referrer: specifies the HTTP host from which requests must come.</li>
	<li>Geography: specifies the geography to which requests are allowed or from requests are restricted.</li>
	<li>Client IP address: specifies a single IPv4 or IPv6 address to which the restriction applies.&nbsp; Note: Classless Inter-Domain Routing (CIDR) or network ranges are currently not supported.</li>
</ul>

<p>Use the <strong>Add Rule</strong> button in the Restrictions area to create a restriction.</p>

<p><img alt="" border="2" height="193" src="/knowledge_center/sites/default/files/field/image/Screen%20Shot%202015-10-02%20at%202.23.56%20PM.png" width="740" /></p>

<p>Choose the <strong>Type</strong> of restriction that you want to define. Use <strong>Access</strong> to indicate whether you want to <strong>Allow</strong> or <strong>Block</strong> requests.</p>

<p><img alt="" border="2" height="269" src="/knowledge_center/sites/default/files/field/image/Screen%20Shot%202015-10-02%20at%202.24.57%20PM.png" width="446" /></p>

<p>&nbsp;</p>

<h3>Referrer restrictions</h3>

<p>Referrer restrictions allow customers to limit access to their site’s content by checking the <em>referrer header</em> of the incoming request.&nbsp;Users typically implement this type of access control to prevent their images, videos, and other content from being linked to from other sites.&nbsp;For example, a malicious user can check the source code for your site <strong>www.yoursite.com</strong>&nbsp;and see that one of your car images has the source <strong>/images/cars/smartcar.png</strong>.&nbsp;That user could then create a URL from your domain,&nbsp;<strong>www.yoursite.com/images/cars/smartcar.png</strong>,&nbsp;and reference that URL in their own website code.&nbsp;As a result, you get charged for usage from another website, and in some cases, those charges can really add up.</p>

<p>To protect your images or other files, you can implement <em>referrer restrictions</em>.&nbsp;To set this up, Rackspace needs two basic pieces of information: &nbsp;</p>

<ul>
	<li>The <em>referrer</em> tells the CDN what it should expect in the referrer header in the request.&nbsp;</li>
	<li>The <em>path</em> tells the CDN which content should enforce the restriction.&nbsp;</li>
</ul>

<p>To implement multiple Referrer domains to a single path, you can use a space to separate the list of domains that you want to have access in the <strong>Referrer </strong>field. Following is an example:</p>

<p><img alt="" border="2" height="247" src="/knowledge_center/sites/default/files/field/image/Screen%20Shot%202015-10-02%20at%201.46.58%20PM.png" width="407" /></p>

<p><strong>Note</strong>: Rackspace does not recommend implementing referrer restrictions for an entire domain.&nbsp;</p>

<p>For the referrer information, most browsers insert the referrer header automatically for every request. For example, if an image is requested from your site, the browser automatically inserts the header as&nbsp;<strong>www.yoursite.com</strong>. If your images are being requested from another site, the browser inserts the referrer header of that site (for example, <strong>www.malicioussite.com</strong>)&nbsp;into the request.&nbsp;The CDN verifies that this referrer header does not match the restriction that you set up and denies the request. In this case, you&nbsp;would&nbsp;have put www.yoursite.com into the <strong>Referrer </strong>field. &nbsp;</p>

<p><strong>Note:</strong> When implementing referrer restrictions, you specify which referrer headers to <em>allow</em>. Requests with all&nbsp;other&nbsp;referrer headers are denied access.&nbsp;</p>

<p><strong>WARNING</strong>:&nbsp;Some browsers might not insert a header automatically.&nbsp;When referrer restrictions are enabled, requests without a referrer header are denied by the CDN.&nbsp;Rackspace recommends using a test domain (for example, <strong>test.yoursite.com</strong>) to test all rules before implementing them on your production domain.&nbsp;<br />
&nbsp;</p>

<h3>Geography restrictions</h3>

<p>Rackspace CDN allows you to restrict content based on geographical regions. See <a href="http://www.rackspace.com/knowledge_center/article/rackspace-cdn-geography-mapping">Rackspace CDN geography mapping</a> for a list of the Rackspace CDN geographical regions and the countries and territories within them.<br />
&nbsp;</p>

<h3>IP address restrictions</h3>

<p>Rackspace CDN allows you to restrict content by specifying the IP address to which the retrictions applies.</p>

<p>&nbsp;</p>

<h2><a id="Rule set up" name="Rule set up"></a>Rule set up</h2>

<p>No matter what type of edge rule you create, the concepts in the following sections apply.<br />
&nbsp;</p>

<h3>Path information</h3>

<p>Each type of edge rule is enforced based on a path. This path tells the network which portion of content should enforce a rule. This path directly relates to the structure of your files on your origin server (or web server). If you have content stored in the <strong>/logos</strong> directory on your server, you can apply a rule to that content by setting the path to <strong>/logos/*</strong>.</p>

<p>NOTE:&nbsp; If you want rules to apply to all content with a directory (including subdirectories), you must include a wildcard (*) after the path. Using the path <strong>/logos/</strong><b>* </b>tells the network to apply your rule to anything with <strong>/logos</strong> in the path. If your path is set to <strong>/logos/*</strong>, the rule applies to all files in that directory, including files in different subdirectories, such as <strong>/logos/partnerA/image.jpg</strong> and <strong>/logos/partnerB/image.png</strong>.&nbsp;<br />
&nbsp;</p>

<h3>Rule Ordering</h3>

<p>Users commonly create multiple rules with the same rule type. For example, when setting up caching rules, you may want one TTL for static content, and another TTL for dynamic content. When creating multiple rules within the same rule “type”, the order of your rules matters.&nbsp;</p>

<p>To properly enforce your rules, they must be ordered from least specific to most specific. For example, your least specific caching rule is the <strong>Catch All TTL</strong>, which applies a TTL of 0 seconds to your entire site, identified by the&nbsp; <strong>/</strong><b> </b>path. Your most specific rule is the&nbsp; <strong>.png</strong> rule, which applies a TTL of 3 days to all files that have the <strong>.png</strong> extension, and which are identified by the path <strong>.png</strong>.</p>

<p>Your least specific rules must appear first in the list of rules in your control panel, and the most specific rules must appear last in this list.&nbsp;If your rules are not ordered correctly, you can address this by deleting your existing rules and recreating them in the proper order.</p>

<p>If you are not sure which rule is more specific, use the guide in the following table.&nbsp; These rules are in order from least specific to most specific.</p>

<table align="left" border="1" cellpadding="1" cellspacing="1">
	<thead>
		<tr>
			<th scope="col">Path</th>
			<th scope="col">Example</th>
		</tr>
	</thead>
	<caption>Rule Order: General to specific</caption>
	<tbody>
		<tr>
			<td>Whole-site wildcard</td>
			<td>
			<p>/*</p>
			</td>
		</tr>
		<tr>
			<td>URL path</td>
			<td>/images/*</td>
		</tr>
		<tr>
			<td>Detailed URL path</td>
			<td>/images/logos/partnerA/*</td>
		</tr>
		<tr>
			<td>File Extension</td>
			<td>/*.png</td>
		</tr>
	</tbody>
</table>
