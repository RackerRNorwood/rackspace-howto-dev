---
node_id: 1319
title: Installing NGINX and PHP-FPM - Setup for NGINX
permalink: article/installing-nginx-and-php-fpm-setup-for-nginx
type: article
created_date: '2012-03-13 00:40:51'
created_by: Kevin Carter
last_modified_date: '2015-11-12 16:4734'
last_modified_by: Nate.Archer
products: Cloud Servers
categories: 'Ubuntu/Debian Linux,Apache,Nginx'
body_format: tinymce
---

<p>After NGINX installed, you can set up&nbsp;NGINX and PHP-FPM to work on your system.</p>

<p>NGINX enables&nbsp;you to change the outlook on your web application from complexity&nbsp;to simplicity.&nbsp;If you have been using Apache, NGINX might&nbsp;be confusing to you. However,&nbsp;you will see&nbsp;some familiar directives and directives&nbsp;that you might&nbsp;recognize. For more information on NGINX, see the&nbsp;<a href="http://wiki.nginx.org/Main">NGINX Wiki</a>.</p>

<h2>Set up NGINX configuration files</h2>

<p>To set up&nbsp;NGINX, you must change the following configuration files, which are&nbsp;contained in the directory <strong>/etc/nginx/</strong>.&nbsp;</p>

<ul>
	<li class="p3"><strong>nginx.conf</strong></li>
	<li class="p3">f<strong>astcgi params</strong></li>
</ul>

<p>You can also add the following&nbsp;files&nbsp;if you want&nbsp;to use NGINX in your deployment of a virtual host.</p>

<ul>
	<li><strong>security</strong></li>
	<li><strong>mail.conf</strong></li>
</ul>

<p>Before you change the&nbsp;configuration files, we&nbsp;recommended that you back up the original configuration files by using the following command:</p>

<pre>
tar -czf ~/NGINX_Config.tar.gz nginx.conf fastcgi_params</pre>

<h3>nginx.conf</h3>

<p>Below is an example of how you can change your <strong>nginx.conf</strong> flie. The file contains two include&nbsp;parameters in the <strong># Virtual Host Configs</strong>&nbsp;area, which allow&nbsp;you to have a separate configuration file directory and a separate virtual host file directory. Although&nbsp;these parameters are not necessary, they simplify the deployment of virtual hosts.&nbsp;</p>

<p class="p4">&nbsp;</p>

<pre class="p6">
user nginx www-data;
worker_processes 4;
pid /var/run/nginx.pid;

events {
	worker_connections 768;
	# multi_accept on;
}

http {
# Basic Settings
	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

# Logging Settings
log_format gzip '$remote_addr - $remote_user [$time_local]  '
                '"$request" $status $bytes_sent '
                '"$http_referer" "$http_user_agent" "$gzip_ratio"';

	access_log /var/log/nginx/access.log gzip buffer=32k;
	error_log /var/log/nginx/error.log notice;

# Gzip Settings
	gzip on;
	gzip_disable "msie6";

	gzip_vary on;
	gzip_proxied any;
	gzip_comp_level 6;
	gzip_buffers 16 8k;
	gzip_http_version 1.1;
	gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;

# Virtual Host Configs
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;

}
</pre>

<p>NGINX can accommodate a single long configuration file, similar to an Apache <strong>httpd.conf </strong>file. Although you can modify the file to fit the needs of your particular environment, we recommend that you use the configuration shown in the example because&nbsp;this configuration will work for most production systems.</p>

<h3 class="p7">fastcgi params</h3>

<p>Use the following parameters&nbsp;in your <strong>fastcgi params</strong> file:</p>

<pre class="p6">
fastcgi_param	QUERY_STRING		$query_string;
fastcgi_param	REQUEST_METHOD		$request_method;
fastcgi_param	CONTENT_TYPE		$content_type;
fastcgi_param	CONTENT_LENGTH		$content_length;

fastcgi_param	SCRIPT_NAME		$fastcgi_script_name;
fastcgi_param	REQUEST_URI		$request_uri;
fastcgi_param	DOCUMENT_URI		$document_uri;
fastcgi_param	DOCUMENT_ROOT		$document_root;
fastcgi_param	SERVER_PROTOCOL		$server_protocol;
fastcgi_param   SCRIPT_FILENAME 	$document_root$fastcgi_script_name;
fastcgi_param   PATH_INFO 		$fastcgi_script_name;

fastcgi_param	GATEWAY_INTERFACE	CGI/1.1;
fastcgi_param	SERVER_SOFTWARE		nginx/$nginx_version;

fastcgi_param	REMOTE_ADDR		$remote_addr;
fastcgi_param	REMOTE_PORT		$remote_port;
fastcgi_param	SERVER_ADDR		$server_addr;
fastcgi_param	SERVER_PORT		$server_port;
fastcgi_param	SERVER_NAME		$server_name;

# PHP only, required if PHP was built with --enable-force-cgi-redirect
fastcgi_param	REDIRECT_STATUS		200;
</pre>

<h3 class="p1">security</h3>

<p>Although it is not required, adding a security file to your&nbsp;<strong>/etc/nginx</strong> directory will simplify the deployment of a virtual host with NGINX.</p>

<p>Use the following parameters in your security file:</p>

<p class="p8">&nbsp;</p>

<pre class="p6">
## Only requests to our Host are allowed 
#      if ($host !~ ^($server_name)$ ) {
#         return 444;
#      }

## Only allow these request methods ##
## Do not accept DELETE, SEARCH and other methods ##
     if ($request_method !~ ^(GET|HEAD|POST)$ ) {
         return 444;
     }

## Deny certain Referers ###
     if ( $http_referer ~* (babes|forsale|girl|jewelry|love|nudit|organic|poker|porn|sex|teen) )
     {
         return 404;
         return 403;
     }

</pre>

<h3>mail.conf</h3>

<p>The mail.conf file is a strictly optional file for those who want&nbsp;to use NGINX&nbsp;as a high-performance mail proxy server. It contains mail directives typically found in the <strong>nginx.conf</strong> file.</p>

<p>If you chose to include <strong>mail.conf</strong> in your NGINX&nbsp;configuration, place the file in the <strong>/etc/nginx/conf.d/</strong> directory.</p>

<p>Use the following parameters in your <strong>mail.conf</strong> file:</p>

<pre class="p6">
#mail {
#       # See sample authentication script at:
#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#       # auth_http localhost/auth.php;
#       # pop3_capabilities "TOP" "USER";
#       # imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#       server {
#               listen     localhost:110;
#               protocol   pop3;
#               proxy      on;
#       }
#
#       server {
#               listen     localhost:143;
#               protocol   imap;
#               proxy      on;
#       }
#}
</pre>

<p>Note&nbsp;how each directive is commented out. If you want to change your NGINX&nbsp;configuration for a high-performance mail proxy server, uncomment the preceding directives above by deleting every #.</p>

<h2 class="p8">Set up virtual hosts</h2>

<p>After you have completed your NGINX&nbsp;configuration, you can set up your virtual hosts. In Debain, the following subdirectories under the <strong>/etc/nginx/&nbsp;</strong>directory pertain to virtual hosts:</p>

<ul>
	<li><strong>sites-available</strong>, where you house your virtual hosts</li>
	<li><strong>sites-enabled</strong>, where your virtual hosts live after they are active</li>
</ul>

<p>These subdirectories function in much the same way as their Apache equivalents.&nbsp;The sites-available directory contains a virtual host config file. You can either copy or symlink the file from one place to the other.</p>

<p>To symlink a virtual host config file from one directory to another, enter the follwoing&nbsp;command:</p>

<pre class="p6">
ln -s /etc/nginx/sites-available/THE.VIRTUAL.HOST.FILENAME /etc/nginx/sites-enabled/THE.VIRTUAL.HOST.FILENAME</pre>

<p>After you have symlinked your virtual host config file, navigate to the <strong>/etc/nginx/sites-available/</strong> directory. You will build your virtual hosts from this directory.</p>

<p>Following is an example of a virtual host file set up for instances using PHP. Replace DOMAINNAME with the name of the domain for which you want to create a virtual host.</p>

<pre class="p6">
server {
    server_name  www.DOMAINNAME;
    rewrite ^(.*) http://DOMAINNAME$1 permanent;
}

server {
        listen 80;
        server_name DOMAINNAME;
                root   /var/www/DOMAINNAME/htdocs;
                index index.php;
		include /etc/nginx/security;

# Logging --
access_log  /var/log/nginx/DOMAINNAME.access.log;
error_log  /var/log/nginx/DOMAINNAME.error.log notice;

        # serve static files directly
        location ~* ^.+.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt)$ {
            access_log        off;
            expires           max;
        }
 
        location ~ \.php$ {
		try_files $uri =404;
                fastcgi_pass unix:/var/run/php5-fpm/DOMAINNAME.socket;
                fastcgi_index index.php;
                include /etc/nginx/fastcgi_params;
        }
}
</pre>

<p><strong>Note:&nbsp;</strong>Please review the PHP section of this virtual host template. This is the first reference to using UNIX file sockets for processing PHP.</p>

<p class="p4">&nbsp;</p>

<p>If you want&nbsp;to create a virtual host without PHP, remove the PHP portion of the previous configuration file:</p>

<pre class="p6">
server {
    server_name  www.DOMAINNAME;
    rewrite ^(.*) http://DOMAINNAME$1 permanent;
}

server {
        listen 80;
        server_name DOMAINNAME;
                root   /var/www/DOMAINNAME/htdocs;
                index index.php;
		include /etc/nginx/security;

# Logging --
access_log  /var/log/nginx/DOMAINNAME.access.log;
error_log  /var/log/nginx/DOMAINNAME.error.log notice;

        # serve static files directly
        location ~* ^.+.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt)$ {
            access_log        off;
            expires           max;
        }
}
</pre>

<p>Both virtual host files you will see that there is a line for&nbsp;<strong>root /var/www/DOMAINNAME/htdocs</strong>.&nbsp;This line should point to the location where you have placed the&nbsp;files that you want the virtual host file to serve.</p>

<p>Now that you have configured NGINX&nbsp;and created your virtual hosts, you are now ready to configure PHP-FPM.</p>

<p class="p2">&nbsp;</p>
