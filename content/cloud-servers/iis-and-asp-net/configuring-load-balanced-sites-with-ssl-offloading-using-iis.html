---
node_id: 3229
title: Configuring Load Balanced Sites with SSL offloading using IIS
permalink: article/configuring-load-balanced-sites-with-ssl-offloading-using-iis
type: article
created_date: '2012-12-03 22:11:43'
created_by: Rae D. Cabello
last_modified_date: '2013-08-02 13:3351'
last_modified_by: kyle.laffoon
products: Cloud Servers
categories: IIS and ASP.NET
body_format: tinymce
---

<p>The following article will demonstrate how to&nbsp;Configure Load Balanced Sites with SSL offloading using IIS. Take a look at the following instructions:</p><h2>Create a web server to use a template</h2><p>1. Create a web server and set up your Site in IIS. Test the Site to make sure it is functioning correctly.</p><h2>&nbsp;</h2><h2>Create a Load Balancer</h2><p>1. Make sure to use protocol / port HTTP:80</p><p>2. Click the edit button next to Secure Traffic (SSL). Make sure you are allowing secure and</p><p>insecure traffic and using the default HTTPS port 443. Then fill in the certificate information:</p><p><img title="" src="http://www.rackspace.com/knowledge_center/sites/default/files/field/image/load-balanced-sites-IIS.png" alt="" width="444" height="438" border="2" /></p><h2>&nbsp;</h2><h2>Create a Conditional Redirect</h2><p>1. IIS 7 does not support conditional redirects out of the box. You will need to install an extension to handle this. URL Rewrite is a good tool provided by Microsoft for accomplishing this. You can download this here:</p><p><a href="http://www.iis.net/downloads/microsoft/url-rewrite">http://www.iis.net/downloads/microsoft/url-rewrite</a></p><p>2. Rackspace Cloud Load Balancers pass a header value to determine the original protocol used by the request (HTTP / HTTPS). This header is labeled X_FORWARDED_PROTO. Its value will either be “http” or “https”.</p><p>3. You can set up Conditional Redirect by Site, or for the IIS instance. For this example, we are going to use rewrite on the Site level. Insert the following XML into your web.config file in the system.webServer section:</p><p><pre>&lt;rewrite&gt;
    &lt;globalRules&gt;
&lt;rule name="HTTPS Redirect" enabled="true" stopProcessing="true"&gt;
    &lt;match url="(.*)" /&gt;
&lt;conditions&gt;
&lt;add input="{HTTP_X_FORWARDED_PROTO}" pattern="https" negate="true" /&gt;
&lt;add input="{SERVER_PORT}" pattern="8080" negate="true" /&gt;
    &lt;/conditions&gt;
&lt;action type="Redirect" url="https://{HTTP_HOST}/{R:1}" /&gt;
&lt;/rule&gt;
    &lt;/globalRules&gt;
&lt;/rewrite&gt;</pre>&nbsp;</p><p>4. In addition to adding this rule, you will need to add a binding to the site for port 8080. This will allow for monitoring services to test this server directly without binding a certificate to the Site.</p><p>5. Open a Firewall port for direct testing. Depending on your security concerns, you can open port 8080 to all IP addresses, or just to a range used by your pollers. Opening this port will allow the Site to be loaded without encryption from a remote IP address.</p><p>&nbsp;</p><h2>Create a Monitoring Check</h2><p>1. On the Rackspace Cloud Portal, open the server you want to create the monitor for.</p><p>2. In the section “Monitoring Checks” click “Create Check”</p><p>3. Change the Check Type to “HTTP Check (Website)”</p><p>4. Give the Check a meaningful name</p><p>5. Use the IP address of the server as the URL, designating port 8080. You will find the IP address in the “Networks” section above. If you are hosting multiple sites on the server, you will need to give the server its own DNS name (i.e. web1.customerdomain.com). Use this domain name instead of the IP address and make sure to designate port 8080.</p><p><img title="" src="http://www.rackspace.com/knowledge_center/sites/default/files/field/image/load-balanced-sites-iis-2.png" alt="" width="591" height="167" border="2" /></p><p>6. Click “Create Check” to confirm your entries</p><p><img title="" src="http://www.rackspace.com/knowledge_center/sites/default/files/field/image/load-balanced-sites-iis-3.png" alt="" width="354" height="218" border="2" /></p>
