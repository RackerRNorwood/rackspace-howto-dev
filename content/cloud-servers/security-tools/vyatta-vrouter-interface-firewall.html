---
node_id: 4234
title: 'Vyatta vRouter: Configure an interface firewall'
permalink: article/vyatta-vrouter-interface-firewall
type: article
created_date: '2014-09-11 16:20:49'
created_by: sameer.satyam
last_modified_date: '2015-02-18 20:5323'
last_modified_by: rose.contreras
products: Cloud Servers
categories: Security Tools
body_format: tinymce
---

<p>Brocade Vyatta vRouter can be configured for two methods of firewall operations: interface-based firewalls and zone-based firewalls. Because it is the standard method of firewall deployment, this article describes how to configure an interface-based firewall.</p>

<p>Use the following parameters for the configuration examples in this article:</p>

<table>
	<tbody>
		<tr>
			<td>INSIDE</td>
			<td>eth1</td>
			<td>10.0.0.0/24</td>
		</tr>
		<tr>
			<td>APP</td>
			<td>eth2</td>
			<td>172.16.10.0/24</td>
		</tr>
		<tr>
			<td>DMZ</td>
			<td>eth3</td>
			<td>192.168.100.0/24</td>
		</tr>
		<tr>
			<td>PUBLIC</td>
			<td>eth0</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td>Local</td>
			<td>local</td>
			<td>&nbsp;</td>
		</tr>
	</tbody>
</table>

<p>&nbsp;</p>

<h2>Log in to the router</h2>

<p>First, log in to the vRouter and put it into configuration mode.</p>

<pre>
configure</pre>

<h2>Allow established and related traffic</h2>

<p>You need to configure a rule that allows all established (session) or related (ALG, FTP) traffic through the firewall. Otherwise, return traffic for established or related sessions cannot traverse the firewall policies. You can add these globally with a Global State Policy with the following statement:</p>

<pre>
set firewall state-policy established action accept set firewall state-policy related action accept</pre>

<h2>Configure the firewall rule base</h2>

<p>You need to configure the rule base that defines all the parameters of the firewall policy, and then you need to apply your rule base to the interface and the direction of the traffic. As with all other firewall rules, this rule base uses a “first match” policy, which means that you must add the most specific rules at the top of the list. The number of the rule dictates its position in the rule base.</p>

<p>By default, apply your rules inbound, into the interface. There is a limit of 10k lines per firewall rule base. Rules cannot be reordered, so allow space between added rules; space new rules by 10. Lastly, firewall rules are processed POST-DNAT. See the NAT page for more information.</p>

<h2>To configure the interface firewall rule base</h2>

<p>The following are configuration examples to guide in configuring the interface firewall rule base.</p>

<pre>
set firewall name PUBLIC-IN rule 1000 description "Allow 7's to DMZ, 80/443"
set firewall name PUBLIC-IN rule 1000 source address 7.7.7.0/24
set firewall name PUBLIC-IN rule 1000 destination address 192.168.100.0/24
set firewall name PUBLIC-IN rule 1000 destination port http, https
set firewall name PUBLIC-IN rule 1000 protocol tcp
set firewall name PUBLIC-IN rule 1000 action accept

set firewall name DMZ-IN rule 1000 description "Allow mail to APP segment"
set firewall name DMZ-IN rule 1000 destination port smtp
set firewall name DMZ-IN rule 1000 protocol tcp
set firewall name DMZ-IN rule 1000 action accept`
set firewall name DMZ-IN rule 1000 description "BLOCK to INSIDE"
set firewall name DMZ-IN rule 1000 destination address 10.0.0.0/24
set firewall name DMZ-IN rule 1000 action drop
set firewall name DMZ-IN rule 1000 description "BLOCK to APP"
set firewall name DMZ-IN rule 1000 destination address 172.16.10.0/24
set firewall name DMZ-IN rule 1000 action drop
set firewall name DMZ-IN rule 9999 description "ALLOW OUT"
set firewall name DMZ-IN rule 9999 action accept
. . .</pre>

<p><strong>NOTE:</strong> If a field in the rule base is left empty, vRouter interprets that field as nonspecific and allows all possible matches. In the case of source and destination addresses, the vRouter assumes 0.0.0.0/0. In the case of source and destination ports, vRouter assumes all ports. If a port is specified, a protocol must also be specified. If no port is specified, and the protocol field is left empty, vRouter assumes all protocols.</p>

<p>Specify the actions.</p>

<h3>To apply the rule base to the interfaces</h3>

<p>The following configuration examples will help you apply the rule base to the interfaces.</p>

<pre>
set interfaces ethernet eth0 firewall in name PUBLIC-IN
set interfaces ethernet eth1 firewall in name INSIDE-IN
set interfaces ethernet eth2 firewall in name APP-IN
set interfaces ethernet eth3 firewall in name DMZ-IN</pre>

<h2>Configure the local firewall</h2>

<p>vRouter has a specific firewall that you can configure to handle traffic destined for vRouter itself. Each interface can share a single local firewall rule base, or each interface can have a specific rule base configured. As with traditional interface firewall rule bases, create your specific rules first. The naming convention is also similar, -LOCAL. You can then apply that rule base to the interface, as a local firewall.</p>

<h3>To apply the local firewall to the interface</h3>

<p>The following configuration examples will guide you in configuring the local firewall to the interface.</p>

<pre>
set interfaces ethernet eth0 firewall local name PUBLIC-LOCAL
set interfaces ethernet eth1 firewall local name INTERNAL-LOCAL
set interfaces ethernet eth2 firewall local name INTERNAL-LOCAL
set interfaces ethernet eth3 firewall local name INTERNAL-LOCAL</pre>

<h3>Verify the firewall configuration</h3>

<p>The following configuration examples will guide you in verifying the firewall configuration.</p>

<pre>
show firewall name 
show firewall name  statistics
show firewall name  counters</pre>

<h2>Log firewall rules</h2>

<p>You can enable logging for specific firewall rules within the command hierarchy. Enable logging only when needed and disable it after you are done so that vRouter is not flooded with unneeded log messages.</p>

<h3>To enable logging on a specific rule (configuration mode)</h3>

<pre>
set firewall name &lt;'rulebase_name'&gt; rule 10 log enable commit</pre>

<h3>To view (operational mode) active log messages</h3>

<pre>
monitor firewall</pre>

<h3>To disable logging on a specific rule (configuration mode)</h3>

<pre>
delete firewall name &lt;*rulebase_name'&gt; rule 10 log commit</pre>
