---
node_id: 4153
title: Allow or block specific IP addresses from accessing your Cloud Sites website
permalink: article/how-to-block-specific-ip-addresses-from-accessing-my-site-on-cloud-sites
type: article
created_date: '2014-07-22 20:07:40'
created_by: Rackspace Support
last_modified_date: '2015-10-28 17:2740'
last_modified_by: kyle.laffoon
products: Cloud Sites
categories: Security
body_format: tinymce
---

<p>Because of the&nbsp;unique hosting environment of Cloud Sites, a slight addition to the code used for the&nbsp;<strong>Allow/Deny</strong>&nbsp;feature is required.</p>

<p>In Cloud Sites,&nbsp;the requesting IP address coming into a server is the IP address of our load balancing server instead of the visitor's IP address. This means that limiting access by IP address&nbsp;through the <strong>.htaccess</strong> file becomes problematic. To solve this problem, we provide an environment variable called&nbsp;<strong>X-Cluster-Client-Ip</strong>&nbsp;that includes the visitor's IP address.</p>

<p>In the <strong>.htaccess</strong> file that contains&nbsp;your rules, insert the following code.</p>

<h4>Allow&nbsp;only a certain IP addresses</h4>

<pre>
Require all denied
allow from env=allowclient
SetEnvIf X-Cluster-Client-Ip 000.000.000.000 allowclient</pre>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>Require all denied</strong> with <strong>order deny,allow | deny from all</strong>.</p>

<h4>Allow&nbsp;only a certain IP address&nbsp;when your site is using SSL</h4>

<pre>
Require all denied
allow from env=allowclient
SetEnvIf X-FORWARDED-FOR ^000.000.000.000$ allowclient
</pre>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>Require all denied</strong> with <strong>order deny,allow | deny from all</strong>.</p>

<p>You can also use the enviromental variable&nbsp;<strong>HTTP:X-Forwarded-For&nbsp;</strong>for the <strong>Allow Only&nbsp;</strong>feature via SSL.</p>

<h4>Allow only a certain IP address with&nbsp;<strong>HTTP:X-Forwarded-For</strong></h4>

<pre>
RewriteEngine On
RewriteCond&nbsp;%{HTTP:X-Forwarded-For}&nbsp;000\.000\.000\.000
RewriteRule .* - [F]</pre>

<p>Replace&nbsp;<strong>000.000.000.000</strong>&nbsp;with your IP address, which&nbsp;allows only&nbsp;your IP address to access your site. You can then&nbsp;develop your site without restrictions.&nbsp;<strong>You can repeat line 1 to allow multiple IP addresses.</strong></p>

<h4>Deny one or more IP addresses</h4>

<pre>
Require all granted
Deny from env=DenyAccess
SetEnvIf X-Cluster-Client-Ip "^000\.000\.000\.000" DenyAccess
</pre>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>Require all granted |&nbsp;Deny from env=DenyAccess</strong><strong> </strong>with <strong>Order Allow,Deny | Deny from env=DenyAccess | Allow from all</strong>.</p>

<h4>Deny&nbsp;one or more IP addresses when your site is using SSL</h4>

<pre>
Require all granted
Deny from env=DenyAccess
SetEnvIf X-FORWARDED-FOR "^000\.000\.000\.000" DenyAccess
</pre>

<p>Replace&nbsp;<strong>000\.000\.000\.000</strong>&nbsp;with the IP address that you want to deny. This denies&nbsp;the IP address or addresses access to your site.&nbsp;<strong>You can repeat line 1 to deny multiple IP addresses.</strong></p>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>Require all granted |&nbsp;Deny from env=DenyAccess</strong> with <strong>Order Allow,Deny | Deny from env=DenyAccess | Allow from all</strong>.</p>

<p><strong>Important:</strong>&nbsp;Implementing this code might prevent images from loading on your website. To address this issue,&nbsp;you can add the following code do your <strong>.htaccess</strong> file:</p>

<pre>
&lt;FilesMatch "\.(gif|jpe?p|png)$"&gt;
Require all denied
allow from env=allowclient
&lt;/FilesMatch&gt;</pre>

<p><strong>Note</strong>: The preceding example is formatted for Apache 2.4. If using 2.2, replace <strong>Require all denied</strong> with <strong>order deny,allow | deny from all</strong>.</p>
