---
node_id: 230
title: Deploying a Cloud Site with media content on Cloud Files
permalink: article/deploying-a-cloud-site-with-media-content-on-cloud-files
type: article
created_date: '2011-04-04 21:57:40'
created_by: RackKCAdmin
last_modified_date: '2015-09-01 18:0441'
last_modified_by: catherine.richardson
products: Cloud Files
categories: Performance
body_format: tinymce
---

<p><strong>Note:</strong> This article is written for the <a href="https://manage.rackspacecloud.com/pages/Login.jsp">Cloud Sites Control Panel</a>. You can access this interface from the <a href="https://mycloud.rackspace.com">Cloud Control Panel</a> by clicking your username in the upper-right corner of the Cloud Sites Control Panel and selecting "Classic Cloud Control Panel".</p>

<table>
	<tbody>
		<tr>
			<td>
			<h2>Contents</h2>

			<ul>
				<li><a href="#overview">Overview</a></li>
				<li><a href="#prereq">Prerequisites</a></li>
				<li><a href="#upload">Upload the image to Cloud Files</a>
				<ul>
					<li><a href="#exampleone">Example: Using FireUploader (less technical)</a></li>
					<li><a href="#exampletwo">Example: Using Python SDK (more technical)</a></li>
				</ul>
				</li>
				<li><a href="#setup">Set up a Cloud Site</a>
				<ul>
					<li><a href="#createsample">Create a sample HTML page</a></li>
					<li><a href="#redirect">Redirect the image</a></li>
					<li><a href="#createdemo">Create the demo Cloud Site</a></li>
				</ul>
				</li>
				<li><a href="#concl">Conclusion</a></li>
			</ul>
			</td>
		</tr>
	</tbody>
</table>

<p>&nbsp;</p>

<h2>Overview</h2>

<p>In this tutorial, you deploy a simple web page that retrieves an image from the Cloud Files platform. The tutorial uses some rewrite rules to obfuscate the origin URL to optimized searching.</p>

<h2>Prerequisites</h2>

<ul>
	<li><em>(If using the browser to upload)</em> FTP application. <span>FileZilla</span> is a good choice.</li>
	<li><em>(If using program code to upload)</em> <span>Python</span> installed on the local machine.</li>
	<li>A plain text editor (<em>not</em> a word processing program like Microsoft Word or OpenOffice). For Mac OS X or Linux, <span>vim</span> is a good choice. For Windows, consider using <span>NotePad++</span>.</li>
	<li>A picture file. You can use any format, such as JPEG, GIF, or PNG.</li>
	<li>Mozilla Firefox or Python, depending on what method you use to upload to Cloud Files.</li>
</ul>

<h2>Upload the image to Cloud Files</h2>

<p>The first step in this process is to upload your image to a CDN-enabled container in Cloud Files. This section describes two ways to upload the image. The first example describes using a web browser extension called FireUploader, a Mozilla Firefox extension. The next example describes a programmatic approach: uploading files using the Python SDK.</p>

<h3>Example: Using FireUploader (less technical)</h3>

<p>FireUploader is a simple Firefox extension that you can use to upload files directly from your machine to Cloud Files in seconds.</p>

<h4>Install FireUploader</h4>

<ol>
	<li>Open the Firefox browser and go to the <a href="http://www.fireuploader.com/">FireUploader website</a>.</li>
	<li>On the Home page, click <strong>Download</strong>.</li>
	<li>Follow the installation instructions on the site.</li>
	<li>When you are prompted to restart Firefox, do so.</li>
</ol>

<h4>Upload your image file</h4>

<ol>
	<li>Log in to <a href="https://manage.rackspacecloud.com/pages/Login.jsp">Cloud Sites Control Panel</a>.</li>
	<li>In the left navigation pane, click <strong>Your Account &gt; API Access</strong>.</li>
	<li>Copy your username and API key from the information shown when you perform step 2 above.</li>
	<li>In Firefox, select <strong>Tools &gt; FireUploader</strong>.</li>
	<li>In the drop-down menu on the right, select <strong>Mosso</strong> (which is the Rackspace Cloud).</li>
	<li>Click <strong>Manage Accounts</strong>.</li>
	<li>For <strong>User Name</strong>, enter the username you copied in step 3, and for <strong>Password</strong>, and enter the API key that you also copied.
	<p><strong>Note:</strong> Do not use your <strong>manage.mosso.com</strong> password.</p>
	</li>
	<li>Select the remember you password (optional), and then click <strong>Add</strong> and then <strong>Ok</strong>.</li>
	<li>Create a container called <strong>media</strong> in the right-hand Rackspace Cloud (Mosso) pane, as follows:
	<ol type="a">
		<li>In the upper-right corner of the pane, click the blue <strong>Create Directory</strong> icon, name the container <strong>media</strong>, and then click <strong>Ok</strong>.</li>
		<li>Double-click on the newly created <strong>media</strong> container.</li>
		<li>Drag a video or image into the container pane, and wait for the content to upload.</li>
	</ol>
	</li>
</ol>

<h4>Enable the container on CDN</h4>

<ol>
	<li>Log in to <a href="https://manage.rackspacecloud.com/pages/Login.jsp">Cloud Sites Control Panel</a>.</li>
	<li>In the left navigation pane, click <strong>Hosting</strong>, then <strong>Cloud Files</strong>.</li>
	<li>Click the gear icon next to <strong>media</strong> and select <strong>Make Public (Enable CDN)</strong>.</li>
	<li>In the pop-up box, click <strong>Publish to CDN</strong>.</li>
	<li>Click the gear icon next to <strong>media</strong> and select <strong>View All Links</strong>.</li>
	<li>Copy the CDN URL for later.</li>
</ol>

<h3>Example: Using Python SDK (more technical)</h3>

<p>This example assumes that you have pyrax, the Python SDK installed. For more information about setting up the SDK for Python, see <span>pyrax installation for configuration steps</span>.</p>

<h4>The code</h4>

<p>The following script performs a series of simple tasks: it creates a container named <code>media</code>, enables CDN for the container, and then uploads a file to that container.</p>

<pre>
import pyrax
pyrax.set_setting("identity_type", "rackspace")
pyrax.set_credentials("UserName", "APIKey", region="ORD")
cf = pyrax.cloudfiles
cont = cf.create_container("media")
cont.make_public()
print "Beginning upload..."
obj = cont.upload_file("PathToImage")
print "File Uploaded!"
print "Name:", obj.name
print "Size:", obj.total_bytes
print "Content-Type:", obj.content_type</pre>

<p>Line 2 tells pyrax to use the Rackspace identity system for authentication. The pyrax SDK supports all clouds based on OpenStack, and other systems use different authentication systems.</p>

<p>Line 5 creates the container named media, and line 6 publishes it to the CDN.</p>

<h4>Run the script</h4>

<ol>
	<li>Save the script to your desktop and name it cfupload.py.</li>
	<li>Make the following changes in the script:
	<ul>
		<li>On line 3, replace UserName with your manage.rackspacecloud.com username, and replace APIKey with your API key.</li>
		<li>(Optional) On line 3, change the region to any available Rackspace region, such as DFW, IAD, ORD, LON, SYD, or HKG.</li>
		<li>On line 8 replace PathToImage with a valid system path like "/Users/linda/Pictures/image1.jpg" (for Mac) or "C:\\images\\image1.jpg" (for Windows). Note that the backslashes in Windows paths have to be escaped with an extra backslash (\).</li>
	</ul>
	</li>
	<li>Open your terminal.</li>
	<li>Change directories to your desktop.</li>
	<li>Run the following command from your terminal: python cfupload.py</li>
	<li>Wait for the image to upload, which should only take a few seconds, depending on the size of the image file.</li>
</ol>

<p>When the upload is complete, the script prints out details about your newly-uploaded object.</p>

<h2>Set up a Cloud Site</h2>

<p>This section of the tutorial covers creating a simple page that calls the image by using the local server side path and creating a Cloud Site.</p>

<h3>Create a sample HTML page</h3>

<p>You create a simple XHTML page that calls an image on Cloud Files by using the local server side path. This part of the tutorial uses <code>mod_rewrite</code>.</p>

<h3>Redirect the image</h3>

<p>In a <code>.htaccess</code> file, create the rewrite rules that redirect the image to the Cloud Files platform. To do so, you need the CDN URL for the container media that you created. If you did not copy the URL earlier, retrieve it as follows:</p>

<ol>
	<li>Log in to <a href="https://manage.rackspacecloud.com/pages/Login.jsp">Cloud Sites Control Panel</a>.</li>
	<li>In the left navigation pane, click <strong>Hosting</strong>, then <strong>Cloud Files</strong>.</li>
	<li>Click the gear icon next to <strong>media</strong> and select <strong>View All Links</strong>.</li>
	<li>Copy the CDN URL.</li>
</ol>

<p>After you have the CDN URL, create the following rewrite rule in a <code>.htaccess</code> file. Replace the container URL with your own URL and ensure that <code>%{REQUEST_URI}</code> directly follows it with no spaces.</p>

<pre>
RewriteEngine on
RewriteBase /
RewriteRule image1\.jpg  http://c0203623401.cdn.cloudfiles.rackspacecloud.com%{REQUEST_URI}</pre>

<p>This rule rewrites anything called <code>image1.jpg</code>.</p>

<p>The <code>{REQUEST_URI}</code> is a variable that holds the relative path to the file that is being requested, so it will always redirect to the correct place. If you have any questions about <code>mod_rewrite</code>, see the <span>Apache documentation</span>.</p>

<p>If your application resides in a subdirectory of the main site, you might have trouble getting mod_rewrite to work. Try replacing the slash (/) with the subdirectory of your application in the <code>RewriteBase</code> directive, as shown in the FAQ article <span>Why is mod_rewrite not working on my site?</span>.</p>

<h3>Create the demo Cloud Site</h3>

<p>For this tutorial, create a sample Cloud Site by performing the following steps:</p>

<ol>
	<li>Log in to <a href="https://manage.rackspacecloud.com/pages/Login.jsp">Cloud Sites Control Panel</a>.</li>
	<li>In the left navigation pane, click <strong>Hosting &gt; Cloud Sites</strong>.</li>
	<li>Click <strong>Add A Site</strong>.</li>
	<li>In the Add a New Website dialog box, name the domain whatever you like. We recommend that you do not register a domain.</li>
	<li>Follow the steps in the site creation process.</li>
	<li>After the domain has been added, select the <strong>General settings</strong> tab.</li>
	<li>Copy the FTP URL.</li>
	<li>Open your FTP application and log in using the user name and password for this domain.</li>
	<li>Upload the <code>.htaccess</code> file and the simple HTML page that you created to the <code>/www.domain.com/web/content/</code> directory.</li>
</ol>

<p>&nbsp;</p>

<h2>Conclusion</h2>

<p>Now navigate to the sample page that you created. The image is being called from Cloud Files, but if a user looks at your source code, it looks as if the image is being called locally. This redirect doesn’t change the actual HTTP request, but it does obfuscate the URL in the source code.</p>

<p>If you have any questions or comments or if this tutorial is not working for you, send an email to <a href="mailto:cloudfiles@rackspacecloud.com">cloudfiles@rackspacecloud.com</a> and we will answer any questions that you have.</p>

<p>&nbsp;</p>
