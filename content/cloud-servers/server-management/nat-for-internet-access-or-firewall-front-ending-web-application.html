---
node_id: 3256
title: Enable Internet Access on Cloud Servers Using SNAT on a Vyatta Network Appliance
permalink: article/nat-for-internet-access-or-firewall-front-ending-web-application
type: article
created_date: '2013-01-08 22:42:42'
created_by: sameer.satyam
last_modified_date: '2015-09-29 17:3119'
last_modified_by: kyle.laffoon
products: Cloud Servers
categories: Server Management
body_format: tinymce
---

<p>Using a Vyatta Appliance you can allow servers on your Private (isolated) Cloud Network to access software updates and patches. This article explains how to configure a Source Network Address Translation (NAT) rule on the Vyatta Appliance that enables Cloud Servers that initially do not have internet access&nbsp;(no Public interface) to stay updated with the latest updates and patches.</p>

<h2>Use Case: Allow Outbound Traffic for Servers on a Private Cloud Network</h2>

<p>Administrators may choose to completely isolate some of their servers (for example database servers) from the internet for security reasons. Rackspace allows you to provision servers that are only on a Private (isolated) network (no Public interface). These servers will not have access to the Internet and cannot be reached from outside. However, this also prevents them from accessing critical patches and updates.</p>

<p>The following illustration shows a simple web application deployment consisting of a standard three-tier model including Web, Application and Database servers.</p>

<p>Using the Vyatta Appliance these servers can be kept up-to-date with the latest software and patches. This is done by configuring a default gateway on the servers that points to the Vyatta appliance and configuring a NAT Outbound (Source) rule on the Vyatta Appliance, which translates the IP address of the each server to the IP address on the public interface of the Vyatta appliance. This is also known as a Source NAT.</p>

<p>For a comprehensive guide to configuring NAT on the Vyatta appliance, click <a href="https://54712289bdd910def82d-5cc7866f7aae0a382278b5bce7412a4a.ssl.cf1.rackcdn.com/Vyatta-NAT_6.5R1_v01.pdf" target="_blank">here</a>.<span>&nbsp;</span></p>

<p><img alt="" border="2" height="283" src="/knowledge_center/sites/default/files/field/image/FirewallFrontendingWebApp.png" width="563" /></p>

<h2>Configure an Outbound NAT Rule</h2>

<p>The examples in this section contain two IP addresses that represent private and public interfaces as follows:</p>

<ul>
	<li>
	<p>192.x.x.x, private (isolated) interface IP address of the server</p>
	</li>
	<li>
	<p>X.X.X.X, public interface IP address of the Vyatta Appliance</p>
	</li>
</ul>

<p>To configure the Source NAT rule, log on to the Vyatta Appliance and use the Vyatta command-line interface. The examples below show the commands you use to complete this configuration.</p>

<ol>
	<li>Log onto the Vyatta Appliance using ssh:
	<pre>
ssh vyatta@X.X.X.X</pre>

	<p>Where X.X.X.X is the IP address of the Vyatta. You'll see a Welcome to Vyatta message and a prompt to enter your Vyatta password.</p>

	<p>Once you're logged onto the appliance, you can enter a ? or press the Tab key for help.</p>
	</li>
	<li>Enter configuration mode:
	<pre>
vyatta@vyatta: configure
[edit]
vyatta@vyatta#</pre>

	<p>The # symbol indicates you're in configuration mode.</p>
	</li>
	<li>Configure the Source NAT rule 10:
	<pre>
vyatta@vyatta# edit nat source rule 10
[edit nat source rule 10]
vyatta@vyatta#</pre>

	<p>The rule number is arbitrary. As a best practice, leave room between rule numbers so that you can add new rules at a later time if necessary. NAT rules are executed sequentially, starting with the lowest number first.</p>
	</li>
	<li>
	<p>Apply this rule to packets coming from any host on network 192.x.x.0/24, the CIDR of the Isolated network, and going through interface eth0, the Public interface of Vyatta Appliance:</p>

	<pre>
vyatta@vyatta# set source address 192.x.x.x/24</pre>

	<pre>
vyatta@vyatta# set outbound-interface eth0</pre>
	</li>
	<li>
	<p>Specify the translation address. Here we use 'masquerade' keyword. This instructs the system to use the IP address currently assigned to the outbound-interface as the translation address. You can also specify the IP address explicitly instead of using 'masquerade'.</p>

	<pre>
vyatta@vyatta# set translation address masquerade</pre>

	<p>This enables the Vyatta Appliance to use the IP address of &nbsp;eth0 as the source IP address.</p>
	</li>
	<li>
	<p>Commit the change allowing it to take effect:</p>

	<pre>
vyatta@vyatta# commit</pre>
	</li>
	<li>Save the configuration to memory:
	<pre>
vyatta@vyatta# save</pre>

	<p>Any requests from the server on 192.x.x.x/24 are now translated to the public interface IP address of the Vyatta appliance.</p>
	</li>
</ol>

<h3>View the Configuration</h3>

<p>While logged onto the Vyatta Appliance, view the configuration of the Outbound Source rule.</p>

<p>In configuration mode, use the following the command:</p>

<pre>
vyatta@vyatta# show nat source rule 10 
 outbound‚Äêinterface eth0 
 source { 
address 192.x.x.0/24 
 } 
 translation { 
 address masquerade 
}</pre>

<p>In operational mode, use the following command:</p>

<pre>
vyatta@vyatta-ord-6:~$ show nat source rules
&nbsp;Disabled rules are not shown
Codes: X - exclude rule, M - masquerade rule
rule &nbsp; &nbsp;intf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;translation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
M10 &nbsp; &nbsp; eth0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saddr 192.168.2.128/25 to X.X.X.X &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; proto-all &nbsp; &nbsp; &nbsp; &nbsp; sport ANY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</pre>

<h3>&nbsp;</h3>

<h3>Adding a Static Route on the Sever</h3>

<p>You'll need to configure a default gateway on the server. The gateway address should be the interface of the Vyatta Appliance that is on the same isolated network that the server belongs to. An example of a static route configured on an Ubuntu server is shown below. 192.x.x.129 is the IP address of the interface on the Vyatta appliance that is being used as the gateway.</p>

<pre>
root@ubun-2:~# route add -net 0.0.0.0/0 gw 192.x.x.129</pre>

<p>On the server, ping an external address to test the configuration:</p>

<pre>
root@ubuntuweb# ping www.rackspace.com
ping www.wip.rackspace.com (207.97.209.147) 56(84) bytes of data.

64 bytes from www.rackspace.com (207.97.209.147): icmp_req=1 ttl=242 time=28.2 ms</pre>

<h3>This completes the configuration of the Outbound NAT (Source) rule.</h3>
