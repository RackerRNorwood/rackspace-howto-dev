---
node_id: 71
title: Mail Server - Opening Ports in the Linux Firewall
permalink: article/mail-server-opening-ports-in-the-linux-firewall
type: article
created_date: '2011-03-08 18:21:56'
created_by: RackKCAdmin
last_modified_date: '2013-10-17 21:4717'
last_modified_by: jered.heeschen
products: Cloud Servers
categories: 'Linux IPTables,Other Mail Servers'
body_format: tinymce
---

<p>In the <a title="Mail Server - Courier Installation" href="/knowledge_center/index.php/Mail_Server_-_Courier_Installation">previous article</a>&nbsp;we installed and configured the basics of Courier. Now we need to open the ports in our firewall so we can access those services.</p><p>There are standard ports that are used to access most services.</p><p>For example, accessing a website generally uses port 80 for normal (HTTP) web pages and port 443 for secure (HTTPS) pages.</p><h2>SMTP</h2><p><strong>NOTE:</strong> &nbsp;Though SMTP generally uses port 25 for connections, port 587 is actually the preferred port for outbound SMTP traffic due to the widespread abuse of port 25.</p><h2><a name="POP_and_POPS"></a>POP and POPS</h2><p>POP and secure POP use ports 110 and 995 respectively.</p><h2><a name="IMAP_And_IMAPS"></a>IMAP and IMAPS</h2><p>IMAP and secure IMAP use ports 143 and 993 respectively.</p><h2><a name="iptables"></a>iptables</h2><p>Following from the Cloud Server setup, we need to edit the iptables.test.rules files to allow access to those ports. We will use port 25 for SMTP at the moment. You can change it as you see fit.</p><p>1.&nbsp;&nbsp; Open the test rules file using the following command:</p><pre>sudo nano /etc/iptables.test.rules</pre><p>2.&nbsp;&nbsp; Just before the HTTP and HTTPS entries, add the following details:</p><pre># Allows SMTP access
-A INPUT -p tcp --dport 25 -j ACCEPT 

# Allows pop and pops connections 
-A INPUT -p tcp --dport 110 -j ACCEPT
-A INPUT -p tcp --dport 995 -j ACCEPT<br />
# Allows imap and imaps connections 
-A INPUT -p tcp --dport 143 -j ACCEPT
-A INPUT -p tcp --dport 993 -j ACCEPT</pre><p>3. Apply the new rules using the following command:</p><pre>sudo iptables-restore &lt; /etc/iptables.test.rules</pre><p>4.&nbsp;&nbsp; Now check that the rules have been applied using the following command:</p><pre>sudo iptables -L</pre><p>This information should be in the output from the command:</p><pre>ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; all&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state RELATED,ESTABLISHED 
ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:smtp 
ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:pop3 
ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:pop3s 
ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:imap2 
ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:imaps</pre><p>5.&nbsp;&nbsp; Now we have tested the rules, we need to have them applied on a permanent basis.</p><p>You will need to have full root access for the next command so use this command in order to enter the root shell:</p><pre>sudo -i</pre><p>6.&nbsp;&nbsp; Now use the following command:</p><pre>iptables-save &gt; /etc/iptables.up.rules</pre><p>7.&nbsp;&nbsp; Now run this and weâ€™re done:</p><pre>exit</pre><p>This will place you back at the admin users command prompt. Do not stay in the root shell.</p><h2><a name="Summary"></a>Summary</h2><p>Opening the default mail ports in your firewall ensures you have access to the POP, POPS, IMAP, and IMAPS services that we have configured and started in this procedure.</p><p>Now we are ready to add users and domains to our MySQL database and start using the mail server.</p><p>The <a title="Mail Server - Adding domains and users to MySQL" href="/knowledge_center/index.php/Mail_Server_-_Adding_domains_and_users_to_MySQL">next article</a> looks at that in detail.</p><p><a title="Mail Server - Courier Installation" href="/knowledge_center/index.php/Mail_Server_-_Courier_Installation">Previous Article</a><br /> <a title="Mail Server - Adding domains and users to MySQL" href="/knowledge_center/index.php/Mail_Server_-_Adding_domains_and_users_to_MySQL">Next Article</a></p>
