---
node_id: 4049
title: Set up WordPress Multisite with Cloud Sites
permalink: article/setting-up-wordpress-multi-site-with-cloud-sites-wpmu
type: article
created_date: '2014-04-29 20:24:33'
created_by: thomas.hester
last_modified_date: '2015-04-13 21:1923'
last_modified_by: kyle.laffoon
products: Cloud Sites
categories: Content Management Systems
body_format: tinymce
---

<p>WordPress Multisite, which prior to version 3.0 of WordPress was known as WordPress MultiUser (MU), enables you to manage multiple WordPress sites from a single networked WordPress control panel. All of these sites use the same database, themes, plug-ins and file structure to keep everything localized to a single installation. You can deploy sites quickly with the same plug-ins, themes, and template as other sites. As a result, sites are easier to manage and you have more control over site content.</p>

<p>This article explains how to set up WordPress Multisite by leveraging Cloud Sites and Cloud Databases.</p>

<p><strong>Note:</strong> For scalability reasons, this article assumes the use of a Cloud Databases instance to better manage the connections. Database instances range in price, but the recommended starting memory size is 1 GB.</p>

<p>The process is divided into the following steps:</p>

<ol>
	<li><a href="#I_setup">Set up a Cloud Databases instance and install WordPress</a><br />
	&nbsp;
	<ul>
		<li><a href="#I_clouddb">Set up a Cloud Database</a></li>
		<li><a href="#I_installwp">Install WordPress</a><br />
		&nbsp;</li>
	</ul>
	</li>
	<li><a href="#II_WPconfig">Configure WordPress</a><br />
	&nbsp;
	<ul>
		<li><a href="#II_adjURL">Adjust the WordPress address URL</a></li>
	</ul>

	<ul>
		<li>
		<p class="MsoNormal"><a href="#II_MultisiteAllow">Allow WordPress Multisite in wp-config.php</a></p>
		</li>
		<li>
		<p class="MsoNormal"><a href="#II_setupWPMUnetwork">Set up the Multisite network</a></p>
		</li>
		<li>
		<p class="MsoNormal"><a href="#II_establishnetwork">Establish the network</a></p>
		</li>
		<li>
		<p class="MsoNormal"><a href="#II_installplugin">Install the WordPress MU Domain Mapping plug-in</a></p>
		</li>
		<li>
		<p class="MsoNormal"><a href="#II_configureplugin">Configure the Domain Mapping plug-in</a></p>
		</li>
	</ul>
	</li>
	<li><a href="#III_addsites">Add sites to the WordPress network</a></li>
</ol>

<p><a name="I_setup"></a></p>

<h2>1. Set up a Cloud Databases instance and install WordPress</h2>

<h4 class="highlight"><span data-mce-mark="1"><a name="I_clouddb"></a>Set up a Cloud Databases instance</span></h4>

<p class="highlight">Set up a Cloud Databases instance that meets the following criteria:&nbsp;</p>

<ul>
	<li>Located in the same data center as the Cloud Sites account</li>
	<li>1 GB of memory (which can later be increased if needed)</li>
</ul>

<p>The disk space depends on the size of the database, taking into account that it might grow over time. For more information about setting up a Cloud Databases instance, review the following articles:</p>

<div class="highlight">
<ul>
	<li><a href="http://www.rackspace.com/knowledge_center/getting-started/cloud-databases">Getting started with Cloud Databases</a></li>
	<li><a href="http://www.rackspace.com/knowledge_center/article/using-cloud-databases-with-your-cloud-site%20" target="_blank">Using Cloud Databases with your Cloud Site</a></li>
	<li><a href="http://www.rackspace.com/knowledge_center/frequently-asked-question/how-many-connections-does-each-database-instance-size-support">How many connections does each instance size support?</a></li>
</ul>
</div>

<h4 class="highlight"><a name="I_installwp"></a>Install WordPress</h4>

<p>Install WordPress on a Cloud Sites website.&nbsp; This site is the primary domain you will be hosting on WordPress Multisite, and it will serve as the Network Admin and main page. For more information about adding a site to your Cloud Sites control panel and installing WordPress, see the following articles:</p>

<ul>
	<li><a href="http://www.rackspace.com/knowledge_center/article/getting-started-with-cloud-sites-2-1-how-to-add-a-new-website">Getting started with Cloud Sites: How to add a new website</a></li>
	<li><a href="http://www.rackspace.com/knowledge_center/article/installing-wordpress-on-cloud-sites">Installing WordPress on Cloud Sites</a></li>
</ul>

<p><strong>Note:</strong> For this specific installation, we do not recommend the use of the <a href="http://www.rackspace.com/knowledge_center/video/wordpress-one-click-on-cloud-sites">one-click installer</a>.</p>

<p class="highlight"><img alt="wp-db-configuration-screen" border="2" height="335" src="/knowledge_center/sites/default/files/field/image/WP_DB_configuration.PNG" width="447" /></p>

<div class="highlight">
<h2><a name="II_WPconfig"></a>2. Configure WordPress</h2>
</div>

<h4 class="highlight"><a name="II_adjURL"></a>Adjust the WordPress address URL</h4>

<p class="highlight">In the WordPress Administration console, go to&nbsp;<strong>Settings</strong>&nbsp;and change the&nbsp;<strong>WordPress Address</strong>&nbsp;(<strong>URL</strong>) value to use <strong>http://<em>yourDomain</em></strong>. Remove the&nbsp;<strong>www</strong>&nbsp;from the URL if it's not already set this way. For example:&nbsp;<strong>http://example.com</strong>e.<br />
&nbsp;</p>

<p class="highlight">&nbsp;<img alt="" border="2" height="18" src="/knowledge_center/sites/default/files/field/image/WP_url_configuration.PNG" width="290" /></p>

<h4 class="highlight"><a name="II_MultisiteAllow"></a>Allow WordPress Multisite in wp-config.php</h4>

<ol>
	<li>In the root WordPress installation directory, locate the <strong>wp-config.php</strong> file and open it in a text editor.</li>
	<li>Locate the line /* That's all, stop editing! Happy blogging. */.</li>
	<li class="highlight">Above that line, add the following line:</li>
</ol>

<pre>
define( 'WP_ALLOW_MULTISITE', true );</pre>

<h4 class="highlight"><a name="II_setupWPMUnetwork"></a>Set up the Multisite network</h4>

<ol>
	<li>In WordPress, go to the admin area, click the <strong>Tools</strong> menu, and then click<strong> Network Setup</strong>.&nbsp;

	<p class="highlight"><img alt="" border="2" height="156" src="/knowledge_center/sites/default/files/field/image/WP_networksetup_menu.PNG" width="159" /><br />
	<strong>Note:</strong>&nbsp;If you are unable to see the Network Setup option, ensure that the <strong>wp-config.php</strong> file has been set to allow WordPress Multisite, as described in the previous step.</p>
	</li>
	<li>Under&nbsp;<strong>Addresses of Sites in your Network</strong>, select the&nbsp;<strong>Subdomains</strong> value if you plan to use domain mapping for multiple URLs. This will make managing the urls easier.</li>
	<li>
	<ol start="1" type="a">
		<li>Under&nbsp;<strong>Addresses of Sites in your Network</strong>, select the&nbsp;<strong>Subdomains</strong> value if you plan to use domain mapping for multiple URLs. This will make managing the urls easier.</li>
		<li>Under <strong>Network Details</strong>, enter values for the&nbsp;<strong>Network Title</strong>&nbsp;and&nbsp;<strong>Network Admin Email</strong>&nbsp;address.</li>
		<li>Click <strong>Install</strong>.</li>
	</ol>

	<p class="highlight"><img alt="" border="2" height="496" src="/knowledge_center/sites/default/files/field/image/WP_networksetup_0.PNG" width="656" /></p>
	</li>
</ol>

<h4><a name="II_establishnetwork"></a>Establish the network</h4>

<ol>
	<li>
	<p>In&nbsp;the <strong><em>pathToYourSite</em>/web/content</strong> folder, open the&nbsp;<strong>wp-config.php</strong>&nbsp;file.</p>
	</li>
	<li>Locate the line&nbsp;/* That's all, stop editing! Happy blogging. */</li>
	<li>
	<p>Above the line, add the following lines<code><code>:</code></code></p>

	<pre>
define ('MULTISITE', true);
define ('SUBDOMAIN_INSTALL', true);
define ('DOMAIN_CURRENT_SITE', 'wpmumainsite.com');
define ('PATH_CURRENT_SITE', '/');
define ('SITE_ID_CURRENT_SITE', 1);
define ('BLOG_ID_CURRENT_SITE', 1);

</pre>
	</li>
	<li>Add the following to your <strong>.htaccess</strong> file in <strong>/PATH/TO/YOUR/SITE/web/content</strong>, replacing other WordPress rules. <span>Keep in mind that this may differ if you use sub-directories for the network instead of subdomains</span>:
	<pre>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]

# add a trailing slash to /wp-admin
RewriteRule ^wp-admin$ wp-admin/ [R=301,L]

RewriteCond&nbsp;%{REQUEST_FILENAME} -f [OR]
RewriteCond&nbsp;%{REQUEST_FILENAME} -d
RewriteRule ^ - [L]
RewriteRule ^(wp-(content|admin|includes).*) $1 [L]
RewriteRule ^(.*\.php)$ wp/$1 [L]
RewriteRule . index.php [L]</pre>

	<p class="highlight"><span data-mce-mark="1"><strong>Note</strong>:</span>: If you do not have an <strong>.htaccess</strong> file, you can create a file called <strong>.htaccess</strong> by using an FTP client such as Filezilla. For more information about <strong>.htaccess</strong> files, see <a href="https://admin.rackspace.com/knowledge_center/article/rackspace-cloud-essentials-5-tips-and-tricks-for-htaccess-and-webconfig#htaccess">Rackspace Cloud Essentials 5 - Tips and Tricks for .htaccess and web.config</a>.</p>
	</li>
	<li>Add the following block of rules to your .htaccess file to force the pages to redirect to non-www versions of the domain:
	<pre>
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ http://%1/$1 [R=301,L]</pre>
	</li>
	<li>Log out of the WordPress Administration console, and then log back in.</li>
</ol>

<p><strong>Note:&nbsp;</strong>Because of the way Cloud Sites works, each site that you need to have managed by the main Multisite installation must be created as an <em>alias</em>. The aliased domain, added through the&nbsp;<a href="https://manage.rackspacecloud.com/">Cloud Sites Control Panel</a>, must have the primary Multisite domain as its target.&nbsp; For more information about how to add an alias, see&nbsp;<a href="https://admin.rackspace.com/knowledge_center/article/getting-started-with-cloud-sites-creating-sub-domains-andor-domain-aliases">Getting Started With Cloud Sites - Creating Sub-domains and/or Domain Aliases</a>.</p>

<p><strong>If you want to map full domains to your multisite entries rather than using subdomains or subfolders in the URL, continue to the next section.</strong></p>

<h4><a name="II_installplugin"></a>Install the WordPress MU Domain Mapping plug-in</h4>

<p class="highlight">After you log back in to the WordPress Administration console, install the WordPress MU Domain Mapping plug-in, as follows:</p>

<ol>
	<li>Go to <strong>My Sites &gt; Network Admin &gt; Plugins</strong>.

	<p class="highlight"><strong><img alt="" border="2" height="228" src="/knowledge_center/sites/default/files/field/image/wpmu-menuhighlighted.png" width="157" /></strong></p>
	</li>
	<li>
	<p class="highlight">Click the <strong>Add New</strong> button.</p>
	</li>
	<li>
	<p class="highlight">Search for <strong>WordPress MU Domain Mapping</strong>.</p>
	</li>
	<li>
	<p class="highlight">Click <strong>Install Now</strong>.</p>

	<p class="highlight"><img alt="" border="2" height="136" src="/knowledge_center/sites/default/files/field/image/WP_MultidomainPluginInstall.PNG" width="783" /></p>
	</li>
	<li>
	<p class="highlight">Activate the plug-in by clicking <strong>Network Activate</strong>.</p>
	</li>
</ol>

<h4 class="highlight"><a name="II_configureplugin"></a>Configure the Domain Mapping plug-in</h4>

<ol>
	<li>
	<p>Copy the <strong><code>../wp-content/plugins/wordpress-mu-domain-mapping/sunrise.php </code></strong>file to the <strong>wp-content/ </strong>folder.</p>
	</li>
	<li>In the&nbsp;<strong>wp-config.php</strong>&nbsp;file, insert the following line above the /* That's all, stop editing! Happy blogging. */&nbsp;&nbsp;line:
	<pre>
define( 'SUNRISE', 'on' );</pre>
	</li>
	<li>In the WordPress Administration console, click <strong>Settings &gt; Domain Mapping</strong>.</li>
	<li>Set the <strong>Server IP Address </strong>value to the current site's IP address.<br />
	<strong>Note: </strong>You can find the site's IP address in the Cloud Sites Control Panel, on the <strong>General Settings</strong> tab or the <strong>DNS</strong> tab (for SSL-enabled sites).</li>
	<li>Under&nbsp;<strong>Domain Options</strong>, select check boxes 2 and 3 only (ensure that the other check boxes are clear), and then click <strong>Save</strong>.
	<p><img alt="" border="2" height="415" src="/knowledge_center/sites/default/files/field/image/dmapping-settings_0.png" width="680" /></p>
	</li>
</ol>

<p>&nbsp;<a name="III_addsites"></a></p>

<h2 class="highlight">3. Add sites to the WordPress network</h2>

<p class="highlight">The final step in this process is to add sites to your WordPress network. To do so, perform the following steps:</p>

<p>The <strong>Edit Site</strong>&nbsp;page opens. In the address bar, the URL should look similar to <strong>http://wpmumainsite.com/wp-admin/network/site-info.php?id=2</strong>.</p>

<ol>
	<li>In the WordPress Administration console, click <strong>My Sites &gt; Network Admin &gt; Sites</strong>.</li>
	<li>Click <strong>Add New</strong>.
	<p class="highlight"><strong><img alt="" border="2" height="178" src="/knowledge_center/sites/default/files/field/image/WP_SiteConfiguration.PNG" width="921" /></strong></p>
	</li>
	<li>
	<p class="highlight">Enter the information for the site that you want to add to the network.</p>

	<p class="highlight"><img alt="" border="2" height="258" src="/knowledge_center/sites/default/files/field/image/WP_addnewsite.PNG" width="381" /></p>
	</li>
	<li>
	<p class="highlight">Click <strong>Add Site</strong>.</p>
	</li>
	<li>
	<p class="highlight">Go back to the <strong>Sites </strong>list by clicking on <strong>Sites &gt; </strong><strong>All Sites</strong> in the left navigation pane.</p>
	</li>
	<li>
	<p class="highlight">From the list, click the site you just added.</p>
	</li>
	<li>
	<p>Note the number that follows after <strong>?id=</strong>. This is the site's <strong>ID </strong>number, and you will need it in the next steps.<br />
	<img alt="" border="2" height="22" src="/knowledge_center/sites/default/files/field/image/WP_siteidURL.PNG" width="345" /></p>
	</li>
	<li>
	<p>In the navigation pane, click on <strong>Settings &gt; Domains</strong>.</p>
	</li>
	<li>
	<p>Under&nbsp;<strong>New Domain</strong>, in the&nbsp;<strong>Site ID&nbsp;</strong>field enter the number that you obtained from the URL.</p>
	</li>
	<li>
	<p>Clear the <strong>Primary</strong> check box.</p>

	<p><img alt="" border="2" height="261" src="/knowledge_center/sites/default/files/field/image/WP_NewDomainID.PNG" width="247" /></p>
	</li>
	<li>
	<p class="highlight">Click <strong>Save</strong>.<br />
	<strong>Note</strong><em>:</em> It is necessary to use the domain without the <strong>www</strong>. If you are using a subdomain, use only the subdomain (for example, <strong>subdomain.domain.com</strong>).</p>
	</li>
</ol>

<p class="highlight">Repeat the steps from this section for any other sites that you want to add to the WordPress Multisite network. Remember to add your alias.</p>

<p class="highlight">You can make adjustments, such as using www instead of non-www. This change, however, will require a different URL rewrite in the <strong>.htaccess</strong> file to force to www versions, which will then cause any subdomains to not map correctly because using www with subdomains does not work in Cloud Sites.</p>
