---
node_id: 3231
title: Introduction to Mailgun Email Automation
permalink: article/introduction-to-mailgun-email-automation
type: article
created_date: '2012-12-06 22:43:42'
created_by: evan.nabors
last_modified_date: '2015-12-21 14:1739'
last_modified_by: kyle.laffoon
products: Cloud Hosting
categories: Other Mail Servers
body_format: full_html
---

<p class="p1">Mailgun is an email automation service provided by Rackspace. It offers a complete cloud-based email service for sending, receiving and tracking email sent through your websites and applications. Mailgun features are available through an intuitive RESTful API or using traditional email protocols like SMTP.</p>

<p class="p1">Rackspace Cloud customers can send 50,000 emails per month for free with Mailgun's basic plan. As of July 2013, Rackspace pre-configures Windows and Linux images for Cloud Servers with Managed Operations to send email via Mailgun using SMTP.</p>

<p>The power of Mailgun comes in its wide array of usecases. Mailgun is capable of integrating with a local postfix service, sending email through SMTP and integrating programmatically with your existing cloud applications. For example, Mailgun, when properly configured, can deliver emails from a blogging software content management system (CMS) such as WordPress, integrate with bug tracking software or any open source software needing to send emails. Mailgun can also be used to handle incoming email.</p>

<p class="p1">Rackspace Cloud customers can access Mailgun from directly within the&nbsp;cloud control panel&nbsp;as pictured below. To send more than the free 50,000 emails/month with the basic plan, you will need to pick a paid plan in the Mailgun control panel.</p>

<p class="p3"><img alt="" src="/knowledge_center/sites/default/files/field/image/1560-3231-newimg_0.png" border="2" width=700 /></p>

<p class="p3">For more information on Mailgun pricing for Rackspace customers, please visit their <a href="http://www.mailgun.com/rackspace" target="_blank">Rackspace pricing page</a>.</p>

<p class="p3">This article will provide example configurations for Mailgun. To get the most from your services with Mailgun be sure to view the advanced resources available in the <a href="#further-reading">Further reading </a>section.</p>

<p class="p3"><strong>On this Page</strong>:</p>

<ul class="ul1">
	<li class="li4"><a href="#using-mailgun-with-postfix">Relaying with Postfix</a></li>
</ul>

<ul class="ul1">
	<li class="li4"><a href="#sending-emails-via-smtp">Sending Emails via SMTP</a></li>
</ul>

<ul class="ul1">
	<li class="li4"><a href="#sending-emails-via-http">Sending Emails via HTTP</a></li>
</ul>

<ul class="ul1">
	<li class="li4"><a href="#receiving-messages-via-http">Receiving Messages via HTTP</a></li>
</ul>

<ul class="ul1">
	<li class="li4"><a href="#further-reading">Further Reading</a></li>
</ul>

<h3 class="p3"><strong><a name="using-mailgun-with-postfix"></a>Relaying with Postfix</strong></h3>

<p class="p3">Configuring Mailgun as a mail relay will allow Postfix to forward emails destined for remote delivery. Before we begin, ensure Postfix is installed and running on the server.</p>

<p class="p3">Note: Our knowledge center contains an article that details the Postfix installation process <a href="http://www.rackspace.com/knowledge_center/article/postfix-installation">here</a>.</p>

<p class="p3">To configure Mailgun we need to modify Postfix configuration options. Postfix configuration options are detailed in the <code>main.cf</code> file.</p>

<p class="p3">Open the file with the text editor of your choice. In this example we use <code>vim</code>&nbsp;.</p>

<pre class="p3">
vim /etc/postfix/main.cf</pre>

<p class="p3">The <code>relayhost</code> parameter specifies the default host to send mail for remote delivery. Here we modify the value to include the Mailgun smtp server hostname and port as shown below.</p>

<pre>
relayhost = [smtp.mailgun.org]:587</pre>

<p>Postfix will now forward external email requests to the Mailgun server.</p>

<p>Next, we configure smtp authentication for the requests. A simple access and security layer (SASL) module handles this in the Postfix config. Modify the following SASL settings.</p>

<pre class="p3">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = static:username:password
smtp_sasl_security_options = noanonymous</pre>

<p class="p3">Note: You will use the username and password&nbsp;from the&nbsp;<a href="https://mailgun.com/sessions/new">Mailgun control panel</a>.</p>

<h4 class="p3">SSL/TLS support (Optional)</h4>

<p>Modify the following configuration options to include SSL/TLS support.</p>

<pre class="p3">
smtp_tls_security_level = may
smtpd_tls_security_level = may
smtp_tls_note_starttls_offer = yes</pre>

<p class="p3">When using TLS encryption, make sure Postfix knows where to locate the Certificate Authority (CA) database for your linux distribution:</p>

<pre class="p3">
smtpd_tls_key_file = /etc/ssl/private/smtpd.key
smtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt
smtpd_tls_CApath = /etc/ssl/certs</pre>

<p class="p3">Revisit the <code>relayhost</code> parameter and configure the SSL/TLS port.</p>

<pre>
relayhost = [smtp.mailgun.org]:465</pre>

<h4 class="p3">Cleanup&nbsp;</h4>

<p class="p3">Reload the Postfix service to load the modifications made in <code>main.cf</code>.</p>

<pre class="p3">
sudo /etc/init.d/postfix restart</pre>

<p class="p3">Postfix will now relay outbound emails to Mailgun.</p>

<h3 class="p3"><strong><a name="sending-emails-via-smtp"></a>Sending emails via SMTP</strong></h3>

<p class="p3">Integration with Mailgun programatically is available from languages with an SMTP library. Let's take a look at a trivial Python script that instructs Mailgun to send an email through SMTP. We will leverage the smtplib library available natively in Python.</p>

<pre class="p3">
import smtplib

def send_message_via_smtp():
    smtp = smtplib.SMTP("smtp.mailgun.org", 587)   
    smtp.login("username@example.com", "password")
    smtp.sendmail("from@example.com", "to@example.com", "mime_message_body")

send_message_via_smtp();</pre>

<p>We begin by importing the smtplib package with <code>import</code>. &nbsp;We then create a Python function to contain the code. Inside we create an object named smtp which is an instance of SMTP. In the login method we pass our mailgun SMTP credentials. In the sendmail method we define the sender, recipient, and email body data. We end the script calling the <code>send_message_via_smtp function</code>.</p>

<p>Note: You will use the username and password&nbsp;from the&nbsp;<a href="https://mailgun.com/sessions/new">Mailgun control panel</a>.</p>

<h3 class="p3"><strong><a name="sending-emails-via-http"></a>Sending emails via HTTP</strong></h3>

<p class="p3">SMTP is the most common protocol used when sending email. It is used by most email applications. However, SMTP may not be the first choice for coding due to MIME format underpenings.&nbsp;Sending via HTTP provides a simpler approach. With HTTP the application simply posts the content as parameters to Mailgun. The parameters match those required when sending a normal email: “From”, “To”, “Cc”, “Bcc”, “Subject” and so on.&nbsp;</p>

<p class="p3">Let's take a look at a trivial cURL example.&nbsp;</p>

<pre class="p3">
curl -s -k --user api:key-3ax6xnjp29jd6fds4gc373sgvjxteol0 \
https://api.mailgun.com/v2/samples.mailgun.org/messages \&nbsp;&nbsp;&nbsp; 
-F from='Excited User &lt;me@samples.mailgun.org&gt;'\&nbsp;&nbsp;&nbsp; 
-F to=tom@example.com\&nbsp;&nbsp;&nbsp; 
-F to=mary@example.com\&nbsp;&nbsp;&nbsp; 
-F subject='Hello'\&nbsp; &nbsp; 
-F text='Testing some Mailgun awesomeness!'&nbsp;</pre>

<p class="p3">The above example sends an email to two different addresses, with a subject of "Hello" and body "Testing some Mailgun awesomeness!".&nbsp;The HTTP API supports features such as file uploads, sending in test mode and more. See the&nbsp;<a href="http://documentation.mailgun.com/user_manual.html">API Documentation</a>&nbsp;for more information.</p>

<h3 class="p3"><strong><a name="receiving-messages-via-http"></a>Receiving messages via HTTP</strong></h3>

<p class="p3">Mailgun is able to receive email via rules you define. This is performed by generating routes within the Mailgun control panel or through the API. Once added, emails reaching Mailgun, for which a route is generated can be forwarded to your application via the use of an HTTP POST or your inbox. The screenshot below presents an example route from the Mailgun control panel.</p>

<p class="p3"><img alt="" src="/knowledge_center/sites/default/files/field/image/1560-3231-newimg2_0.png" width="700" height="" border="2" /></p>

<p class="p3">Routes can be created for static email addresses and for a regular expression (regex) pattern match. They are also available to forward an HTTP request, for sending the email to your application. See <a href="http://documentation.mailgun.com/user_manual.html#receiving-messages">Sending Documentation</a> for more information.</p>

<h3 class="p6"><a name="further-reading"></a><strong>Further Reading</strong></h3>

<p>This article included a few possibilities available with Mailgun. The mailgun website provides extensive API Reference material for multiple languages. Below are a few links that will serve to enchance your experience using the product:&nbsp;</p>

<ul class="ul1">
	<li class="li7">Mailgun&nbsp;<a href="https://documentation.mailgun.com/quickstart.html">Quickstart Guide</a></li>
	<li class="li4">Mailgun&nbsp;<a href="http://documentation.mailgun.com/user_manual.html">User Manual</a></li>
	<li class="li4">Complete Mailgun&nbsp;<a href="http://documentation.mailgun.com/">Documentation</a></li>
	<li class="li4">Mailgun <a href="http://www.mailgun.com/rackspace" target="_blank">pricing page for Rackspace customers</a></li>
</ul>

<p>For support with the Mailgun product, please contact Mailgun directly at:</p>

<ul>
	<li>Email: <a href="mailto:support@mailgun.com">support@mailgun.com</a></li>
	<li>Chat: <a href="http://www.mailgun.com">http://www.mailgun.com</a></li>
</ul>
