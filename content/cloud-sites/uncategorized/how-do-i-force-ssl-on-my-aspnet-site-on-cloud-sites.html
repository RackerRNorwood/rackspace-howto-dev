---
node_id: 621
title: Force SSL on your ASP or ASP.NET site on Cloud Sites
permalink: article/how-do-i-force-ssl-on-my-aspnet-site-on-cloud-sites
type: article
created_date: '2011-03-16 21:57:40'
created_by: RackKCAdmin
last_modified_date: '2015-06-23 17:0157'
last_modified_by: kelly.holcomb
products: Cloud Sites
categories: Uncategorized
body_format: tinymce
---

<p>This article provides examples of how to force SSL on your ASP or ASP.NET site.</p>

<ul>
	<li><a href="#web.config">web.config file</a></li>
	<li><a href="#ASP.NET">ASP.NET (not MVC 3)</a></li>
	<li><a href="#aspnetmvc3">ASP.NET (MVC 3)</a></li>
	<li><a href="#classicASP">Classic ASP</a></li>
</ul>

<h2 id="web.config">web.config file</h2>

<p>If your website has the IIS Rewrite Module available, you can use rewrite rules in your <strong>web.config</strong> file to force SSL on all pages, as shown in the following example.</p>

<p>If you are unsure whether the IIS Rewrite Module is available for your site, contact Support.</p>

<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;
&lt;system.webServer&gt;

  &lt;rewrite&gt;
    &lt;rules&gt;
      &lt;rule name="Redirect to HTTPS" stopProcessing="true"&gt;
        &lt;match url=".*" /&gt;

        &lt;conditions&gt;
          &lt;add input="{HTTP_CLUSTER_HTTPS}" pattern="^on$" negate="true" /&gt;
          &lt;add input="{HTTP_CLUSTER_HTTPS}" pattern=".+" negate="true" /&gt;

        &lt;/conditions&gt;
        &lt;action type="Redirect" url="https://{HTTP_HOST}{SCRIPT_NAME}" redirectType="SeeOther" /&gt;
      &lt;/rule&gt;

    &lt;/rules&gt;
  &lt;/rewrite&gt;
&lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre>

<p>You could modify the example to force SSL on one page or specific pages. For more information about the IIS Rewrite Module, see <a class="external text" href="http://learn.iis.net/page.aspx/461/creating-rewrite-rules-for-the-url-rewrite-module/" title="http://learn.iis.net/page.aspx/461/creating-rewrite-rules-for-the-url-rewrite-module/">Creating Rewrite Rules for the URL Rewrite Module</a> and <a class="external text" href="http://learn.iis.net/page.aspx/465/url-rewrite-module-configuration-reference/" title="http://learn.iis.net/page.aspx/465/url-rewrite-module-configuration-reference/">URL Rewrite Module Configuration Reference</a> on the Microsoft IIS site.</p>

<h2 id="ASP.NET">ASP.NET (not MVC 3)</h2>

<p>Using ASP.NET, you can use the following code to force SSL on a page on your site:</p>

<pre>
&lt;%@ Page Language="C#"&nbsp;%&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;

&lt;script runat="server"&gt;
  protected void Page_Load(object sender, System.EventArgs e)
  {
    if(Request.ServerVariables["HTTP_CLUSTER_HTTPS"]&nbsp;!= "on")
    {
      if(Request.ServerVariables.Get("HTTP_CLUSTER_HTTPS") == null)
      {
        string xredir__, xqstr__;

        xredir__ = "https://" + Request.ServerVariables["SERVER_NAME"];
        xredir__ += Request.ServerVariables["SCRIPT_NAME"];
        xqstr__ = Request.ServerVariables["QUERY_STRING"];

        if (xqstr__&nbsp;!= "")
            xredir__ = xredir__ + "?" + xqstr__;

        Response.Redirect(xredir__);
      }
    }
    Response.Write("SSL Only");
  }

&lt;/script&gt;

&lt;html&gt;
&lt;head id="Head1" runat="server"&gt;
  &lt;title&gt;SSL Only&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>

<h2 id="aspnetmvc3">ASP.NET (MVC 3)</h2>

<p>You can use the following code when using the <code>RequireHttps</code> attribute to decorate actions within your MVC application:</p>

<pre class="p1">
protected void Application_BeginRequest(Object sender, EventArgs e)
{
            if (HttpContext.Current.Request.IsSecureConnection() == false)
            {
                        Response.Redirect("https://" + Request.ServerVariables["HTTP_HOST"] + HttpContext.Current.Request.RawUrl);
            }
}
public static class Extensions
{
            /// &lt;summary&gt;
            /// Gets a value which indicates whether the HTTP connection uses secure sockets (HTTPS protocol). Works with Rackspace Cloud Sites' load balancer
            /// &lt;/summary&gt;
            /// &lt;param name="request"&gt;&lt;/param&gt;
            /// &lt;returns&gt;&lt;/returns&gt;
            public static bool IsSecureConnection(this HttpRequestBase request)
            {
                        const string rsSSLvar = "HTTP_CLUSTER_HTTPS";
                        return (request.IsSecureConnection || (request.ServerVariables[rsSSLvar] != null || request.ServerVariables[rsSSLvar] == "on"));
            }
            /// &lt;summary&gt;
            /// Gets a value which indicates whether the HTTP connection uses secure sockets (HTTPS protocol). Works with Rackspace Cloud Sites' load balancer
            /// &lt;/summary&gt;
            /// &lt;param name="request"&gt;&lt;/param&gt;
            /// &lt;returns&gt;&lt;/returns&gt;
            public static bool IsSecureConnection(this HttpRequest request)
            {
                        const string rsSSLvar = "HTTP_CLUSTER_HTTPS";
                        return (request.IsSecureConnection || (request.ServerVariables[rsSSLvar] != null || request.ServerVariables[rsSSLvar] == "on"));
            }
}

</pre>

<h2 id="classicASP">Classic ASP</h2>

<p>Using classic ASP, you can use the following code to force SSL on a page on your site:</p>

<pre>
&lt;%
Response.Buffer = True
If (Request.ServerVariables("HTTP_CLUSTER_HTTPS") &lt;&gt; "on") Then
  If IsEmpty(Request.ServerVariables("HTTP_CLUSTER_HTTPS")) Then
    Dim xredir__, xqstr__

    xredir__ = "https://" &amp; Request.ServerVariables("SERVER_NAME") &amp; _
               Request.ServerVariables("SCRIPT_NAME")
    xqstr__ = Request.ServerVariables("QUERY_STRING")

    If xqstr__ &lt;&gt; "" Then xredir__ = xredir__ &amp; "?" &amp; xqstr__

    Response.Redirect xredir__
  End If
End If

Response.Write("SSL Only")
%&gt;</pre>
