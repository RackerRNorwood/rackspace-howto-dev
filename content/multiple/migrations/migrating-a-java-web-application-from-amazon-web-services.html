---
node_id: 3588
title: Migrating a Java Web Application from Amazon Web Services
permalink: article/migrating-a-java-web-application-from-amazon-web-services
type: article
created_date: '2013-07-02 19:06:14'
created_by: RackKCAdmin
last_modified_date: '2015-09-22 20:1855'
last_modified_by: Mike Asthalter
products: 'Cloud Hosting,Cloud Servers'
categories: Migrations
body_format: tinymce
---

<p>This article describes the migration of a Tomcat and Spring Java web application from Amazon Web Services (AWS) to Rackspace Cloud. It takes an estimated 30 minutes to complete, if you follow the instructions step by step.</p>

<p>These steps assume you have <a href="/knowledge_center/article/provisioning-cloud-resources-to-migrate-from-amazon-web-services" target="_blank">provisioned the Rackspace Cloud services</a> your application will require.</p>

<p>The web application used here is the Spring Framework Petclinic sample available at <a href="https://github.com/SpringSource/spring-petclinic/">github.com/SpringSource/spring-petclinic</a>.</p>

<p>The topology of the application in this scenario is represented in the following figure:</p>

<p><img alt="" height="171" src="/knowledge_center/sites/default/files/field/image/3588-1.png" width="607" /></p>

<h3>Prerequisites</h3>

<ul>
	<li>EC2 instance on AWS with root access running the Spring web application on Apache Tomcat</li>
	<li>Valid and enabled account on Rackspace Cloud</li>
</ul>

<h3>Preparation</h3>

<ul>
	<li>Identify the resources to migrate, including application and database resources.</li>
	<li>Create a list of all the necessary software packages that are installed on your EC2 instance other than your Spring application</li>
	<li>Create a list of all additional Amazon servers that are being used in the application-for example, Simple Email Server (SES) for email or Relational Database Service (RDS) for database.</li>
	<li>If you have not already, <a href="/knowledge_center/article/provisioning-cloud-resources-to-migrate-from-amazon-web-services" target="_blank">create a Cloud Server instance</a> and any supporting Rackspace Cloud services.</li>
</ul>

<h3>Install software packages</h3>

<ol>
	<li>Install OpenJDK on the cloud:
	<ol type="A">
		<li>Using SSH, connect to the Cloud Servers instance by using the PublicNet URL and the root password.</li>
		<li>Enter the root password to log on.</li>
		<li>Install OpenJDK 7.
		<pre>
sudo yum install java-1.7.0-openjdk-devel
</pre>
		</li>
		<li>Determine JAVA_HOME.
		<pre>
ll /etc/alternatives/java
</pre>

		<p>Following is example output in which JAVA_HOME is /usr/lib/jvm/jre-1.7.0-openjdk.x86_64.</p>

		<pre>
/etc/alternatives/java -&gt; /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/java
</pre>
		</li>
	</ol>
	</li>
	<li>Install Tomcat on the cloud server:
	<ol type="A">
		<li>Download Tomcat, selecting the version from the following list: <a href="http://tomcat.apache.org/download-70.cgi">http://tomcat.apache.org/download-70.cgi</a></li>
		<li>Copy the URL of the <strong>tar.gz</strong> file (for example, <strong>http://www.us.apache.org/dist/tomcat/tomcat-7/v7.0.39/bin/apache-tomcat-7.0.39.tar.gz</strong>).</li>
		<li>Change directory to <strong>/usr/share</strong>(or your directory of choice) and download the binary.
		<pre>
cd /usr/share
sudo wget http://www.us.apache.org/dist/tomcat/tomcat-7/v7.0.39/bin/apache-tomcat-7.0.39.tar.gz
</pre>
		</li>
		<li>Change permissions.
		<pre>
sudo chmod 775 apache-tomcat-7.0.39.tar.gz
</pre>
		</li>
		<li>Extract file contents.
		<pre>
sudo tar zxvf apache-tomcat-7.0.39.tar.gz
</pre>
		</li>
		<li>After Tomcat is extracted, remove the <strong>tar.gz </strong>files to save space.
		<pre>
sudo rm apache-tomcat-7.0.39.tar.gz
</pre>
		</li>
		<li>Set environment variables in <strong>catalina.sh</strong>.
		<pre>
cd /usr/share/apache-tomcat-7.0.39/bin
sudo vi catalina.sh
</pre>

		<p>Add the following line immediately after <strong>#!/bin/sh</strong>:</p>

		<pre>
JAVA_HOME=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64
</pre>
		</li>
		<li>Save and exit.</li>
		<li>Automate the startup of Tomcat.
		<pre>
cd /etc/init.d
sudo vi tomcat
</pre>
		</li>
		<li>Add the following information to the file.<br />
		Ensure that JAVA_HOME, TOMCAT_HOME, START_TOMCAT, and STOP_TOMCAT refer to the correct directories.
		<pre>
#!/bin/bash
# chkconfig: 234 20 80
# description: Tomcat Server basic start/shutdown script
# processname: tomcat
JAVA_HOME=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64
export JAVA_HOME
TOMCAT_HOME=/usr/share/apache-tomcat-7.0.39/bin
START_TOMCAT=/usr/share/apache-tomcat-7.0.39/bin/startup.sh
STOP_TOMCAT=/usr/share/apache-tomcat-7.0.39/bin/shutdown.sh
start() {
echo -n "Starting tomcat: "
cd $TOMCAT_HOME
${START_TOMCAT}
echo "done."
}
stop() {
echo -n "Shutting down tomcat: "

cd $TOMCAT_HOME
${STOP_TOMCAT}
echo "done."
}
case "$1" in
start)
start
;;
stop)
stop
;;
restart)
stop
sleep 10
start
;;
*)
echo "Usage: $0 {start|stop|restart}"
esac
exit 0
</pre>
		</li>
		<li>Save and exit.</li>
		<li>Set file permissions, set up Tomcat as a system service, and test the setup.
		<pre>
sudo chmod 755 tomcat
sudo /sbin/chkconfig --add tomcat
sudo /sbin/chkconfig --level 234 tomcat on
sudo /sbin/chkconfig --list tomcat
</pre>

		<p>The expected output looks as follows:</p>

		<pre>
tomcat 0:off 1:off 2:on 3:on 4:on 5:off 6:off
</pre>
		</li>
		<li>Because Tomcat is running on port 8080, ensure iptables will not interfere with connectivity.<br />
		To learn about iptables, see <a href="http://www.rackspace.com/knowledge_center/article/introduction-to-iptables">Introduction to iptables</a>.</li>
		<li>Test Tomcat by looking up the cloud server IP in the Rackspace Cloud Control Panel and opening the URL in a browser (for example, <strong>http://&lt;<em>ipAddress</em>&gt;:8080/</strong>).<br />
		The Apache Tomcat landing page should appear.
		<p><strong>Note:</strong> You can stop and start Tomcat with the following commands:</p>

		<pre>
sudo /sbin/service tomcat stop
sudo /sbin/service tomcat start
</pre>
		</li>
	</ol>
	</li>
	<li>(Optional) Install OpenStack Swift. If you will use Cloud Files to transfer your data, install the swift client to enable access from your server.
	<pre>
sudo yum install python-novaclient python-glanceclient swift
</pre>

	<ol type="A">
		<li>Set the necessary environment variables by running the following commands, substituting your Rackspace Cloud account username and API key:
		<pre>
export ST_USER=&lt;your-login-username&gt;
export ST_KEY=&lt;your-API-key&gt;
export ST_AUTH=https://identity.api.rackspacecloud.com/v1.0/
</pre>

		<p>You might want to define these variables in <strong>.bashrc</strong> or <strong>.bash_profile</strong>, then reload the file with the "source" command.</p>

		<pre>
source .bashrc
</pre>
		</li>
		<li>Type <strong>swift list</strong> and ensure that you can see the container you've created to hold your data.</li>
	</ol>
	</li>
</ol>

<h3>Back up data from AWS to Rackspace Cloud Files</h3>

<p>Retrieve your data from EC2. You can transfer the data directly via <a href="/knowledge_center/article/migrating-a-linux-server-from-the-command-line-stage-1" target="_blank">rsync</a> or sftp, or you can use the OpenStack Swift client to transfer your data to Cloud Files, and from there transfer to the Cloud Server.</p>

<p>To use Cloud Files, follow these preparatory steps (for this example we'll use an existing container named "Tomcat"):</p>

<ol>
	<li>Using SSH, connect to your EC2 instance.
	<pre>
ssh -i <em>your_private_key</em>.pem <em>user</em>@ec2-xxx-xxx-xxx-xxx.compute-1.amazonaws.com</pre>
	</li>
	<li>Perform a database dump.
	<pre>
mysqldump -h &lt;RDS-hostname&gt; -u &lt;RDS-username&gt; -p --triggers --routines --databases petclinic | gzip &gt; ~/petclinic.sql.gz
</pre>
	</li>
	<li>Back up your application and any other resources needed by the application, including logs and other directories of interest.
	<pre>
# make sure you have the correct tomcat7 directory
sudo tar cvzf ~/tomcat.tar.gz /usr/share/tomcat7/webapps/*
</pre>
	</li>
	<li>If you are using Cloud Files to transfer your files, use one of the following methods to perform the transfer. If you will transfer directly via rsync or sftp, skip to the final section of this article after the transfer.
	<ul>
		<li>Upload your archives to the Cloud Files container via the swift client.
		<pre>
swift upload Tomcat petclinic.sql.gz
swift upload Tomcat tomcat.tar.gz
</pre>
		</li>
		<li>Upload your data into Cloud Files through the Cloud Control Panel.
		<ol type="A">
			<li>Open your container (<strong>Cloud Control Panel &gt; Files &gt; <em>containerName</em></strong>).</li>
			<li>Click <strong>Upload Files</strong>.</li>
			<li>Click <strong>Browse</strong>and select the files to upload.
			<p><strong>Note:</strong> When you click the <strong>Browse</strong> button, you can select multiple files.</p>
			</li>
			<li>After you have selected the file or files, click <strong>Open</strong> or <strong>Select</strong> (depending on the browser and system).</li>
			<li>Click <strong>Upload File</strong>.</li>
		</ol>
		</li>
	</ul>
	</li>
</ol>

<h3>Restore data from Cloud Files to Cloud Servers</h3>

<p>If you uploaded your data to Cloud Files, transfer it to your Cloud Server with the following steps.</p>

<ol>
	<li>Using SSH, connect to the Cloud Servers instance by using the PublicNet URL and the root password.</li>
	<li>Install and configure the Swift CLI as described in the "Install software packages" section.</li>
	<li>Ensure that you can execute swift list and see the new container that you created in the results.</li>
	<li>Download the database dump from the backup that you took in the "Back up data from AWS to Rackspace Cloud Files" section and restore it locally.
	<pre>
swift download Tomcat petclinic.sql.gz
gunzip &lt; petclinic.sql.gz | mysql -u &lt;Cloud-Database-uername&gt; -p -h &lt;Cloud-Database-hostname&gt;
</pre>
	</li>
	<li>Stop Tomcat, download the application files, and extract them.
	<pre>
sudo /sbin/service tomcat stop
swift download Tomcat tomcat.tar.gz
tar -zxvf tomcat.tar.gz
</pre>
	</li>
	<li>Copy the extracted web application contents to the local Tomcat <strong>webapps</strong>directory and modify the application properties (jdbc.url, database user name, database password, and so on).
	<p>Additionally, in the Spring Framework Petclinic sample, the following files must be commented out:</p>

	<pre>
    petclinic/WEB-INF/classes/db/mysql/initDB.sql
    petclinic/WEB-INF/classes/db/mysql/populateDB.sql
</pre>
	</li>
	<li>Restart Tomcat.
	<pre>
sudo /sbin/service tomcat start
</pre>
	</li>
</ol>

<h3>Test your application</h3>

<p>Access the web application at <strong>http://&lt;<em>cloudServerIPAddress</em>&gt;:8080/petclinic</strong>.</p>

<p>Before making your migrated application available to the public, we recommend <a href="/knowledge_center/article/post-migration-considerations-when-migrating-from-amazon-web-services">weighing some post-migration considerations</a> like the security of your setup, monitoring its availability, and ensuring your data is regularly backed up.</p>
