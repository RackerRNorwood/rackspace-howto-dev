---
node_id: 1438
title: Testing Network Services with netcat
permalink: article/testing-network-services-with-netcat
type: article
created_date: '2012-06-21 14:50:48'
created_by: RackKCAdmin
last_modified_date: '2014-04-04 12:5312'
last_modified_by: kyle.laffoon
products: Cloud Servers
categories: Linux Tools
body_format: tinymce
---

<div id="task_jfg_d2y_jf" class="nested0"><h3 class="title topictitle1">Using netcat</h3><div class="body taskbody"><div class="section steps-informal"><p class="p">If you have a network service that's not behaving like it should but you know it's <a class="xref" href="/knowledge_center/content/checking-listening-ports-netstat">listening to a network port</a>, you can take a closer look at a connection to the program to see if it reveals the problem.</p><p class="p">We will now use nc, a.k.a. netcat, to test access to the service. If nc is not installed by default - run "<samp class="ph codeph">sudo yum install nc</samp>" on Red Hat-based distros or "<samp class="ph codeph">sudo apt-get install netcat</samp>" on Debian-based distros.</p></div></div></div><div id="concept_sxn_xmy_pg" class="topic concept nested0"><h3 class="title topictitle1">Basic test</h3><div class="body conbody"><div class="section"><p class="p">First we'll run a simple test to see if the port accepts connections. We'll do that with the nc command and the"-vz" option:</p><pre class="pre codeblock">nc -vz IP_Address Port
</pre><p class="p">The IP address should be the one on which the service receives connections.</p><p class="p">The following three examples show the possible output:</p></div><div class="section"><h4 class="title sectiontitle">The connection is successfully made</h4><pre class="pre codeblock">nc -vz 203.0.113.96 21
Connection to 203.0.113.96 21 port [tcp/ftp] succeeded!
</pre></div><div class="section"><h4 class="title sectiontitle">The connection is refused</h4><pre class="pre codeblock">nc -vz 203.0.113.96 80
nc: connect to 203.0.113.96 port 80 (tcp) failed: Connection refused
</pre></div><div class="section"><h4 class="title sectiontitle">There is no response to the connection request</h4><pre class="pre codeblock">nc -vz 203.0.113.96 80
nc: connect to 203.0.113.96 port 80 (tcp) failed: Connection timed out
</pre></div></div></div><div id="task_r1x_nfy_jf" class="topic task nested0"><h3 class="title topictitle1">Connection refused</h3><div class="body taskbody"><div class="section steps-informal"><p class="p">You'll usually see this response when the service isn’t running or a firewall is rejecting the connection.</p><p class="p">If you haven't already confirmed that the service is running you can check using the ps and service commands as explained in the <a class="xref" href="/knowledge_center/content/checking-running-services-linux">previous article in this series on checking running services</a>.</p><p class="p">If your service is running it's likely the connection being refused because your firewall is rejecting the connection. Take a look at the “connection timed out” section for instructions on troubleshooting your firewall.</p></div></div></div><div id="task_2qm_xfy_jf" class="topic task nested0"><h3 class="title topictitle1">Connection timed out</h3><div class="body taskbody"><div class="section steps-informal"><p class="p">A connection timed out response indicates that your connection is not getting to the service. Often this happens when when your firewall is blocking the port. The simplest way to test this is to temporarily add a rule that will accept connections on the required port.</p><p class="p">The following example inserts a rule on line 1 of the input chain that will accept all tcp connections on port 80 (http). This rule would be used when testing a web server such as Apache.</p><pre class="pre codeblock">sudo /sbin/iptables -I INPUT 1 -p tcp --dport http -j ACCEPT
</pre><p class="p">iptables will instantly update with any changes made. Repeat the test with nc to see if there is any change in the response.</p><p class="p">If you want to remove the rule you have added you can use the -D option as well as the position of the rule in the chain. In the previous example we added a rule at line 1, the top of the chain. The following example shows how to remove it.</p><pre class="pre codeblock">sudo /sbin/iptables -D INPUT 1
</pre><p class="p">You can check your current firewall configuration at any time by running the following:</p><pre class="pre codeblock">sudo /sbin/iptables -L -v
</pre><p class="p">If adding the rule resolves the issue please take a look at <a class="xref" href="http://www.rackspace.com/knowledge_center/index.php/Introduction_to_iptables">our article on iptables</a> for information regarding editing rules and saving the configuration.</p></div></div></div><div id="task_c2f_p2y_jf" class="topic task nested0"><h3 class="title topictitle1">Connection succeeded</h3><div class="body taskbody"><div class="section steps-informal"><p class="p">If the initial connection succeeds it indicates that nc can connect to the service. Now we should look at the connection in a bit more detail.</p><p class="p">First use the "-vt" option to see if the service can respond to basic network queries:</p><pre class="pre codeblock">nc -vt IP Address Port
</pre><p class="p">Are you able to connect, send commands to the service-daemon and receive responses? If so, that indicates that the program is accessible and your issue may be due to the way the client is trying to connect or how the service is configured to respond to the connection.</p><p class="p">Once you've connected you may also need to send some information to the service to get a response. You might send a GET request to a web server, for example, or some other appropriate data before you'll receive a response from the service.</p></div></div><div id="concept_kl2_zpy_pg" class="topic concept nested1"><h4 class="title topictitle2">Closing the connection</h4><div class="body conbody"><p class="p">To close the connection you can either press Ctrl + C or type the service specific quit command.</p><p class="p">As an example, you can close a connection to an FTP server with the "QUIT" command:</p><pre class="pre codeblock">nc -vt 203.0.113.96 21
Connection to 203.0.113.96 21 port [tcp/ftp] succeeded!
220 (vsFTPd 2.0.5)
QUIT
221 Goodbye.
</pre></div></div><div id="concept_sbn_yqy_pg" class="topic concept nested1"><h4 class="title topictitle2">Commands rejected</h4><div class="body conbody"><p class="p">If nc reports success but does not allow you to send any commands or you get a response from the service-daemon reporting the service is not available, you may have tcp wrappers providing access control.</p><p class="p">An FTP service being blocked by tcp wrappers could look like this:</p><pre class="pre codeblock">nc -vt 203.0.113.96 21
Connection to 203.0.113.96 21 port [tcp/ftp] succeeded!
421 Service not available.
</pre><p class="p">If the program is compatible with tcp wrappers it will have been compiled with libwrap. To check if a program can make use of tcp wrappers use the following command:</p><pre class="pre codeblock">ldd /path/to/binary | grep libwrap
</pre><p class="p">In the following example the vsftpd program is checked for the libwrap shared library file.</p><pre class="pre codeblock">ldd /usr/sbin/vsftpd | grep libwrap
libwrap.so.0 =&gt; /lib64/libwrap.so.0 (0x00007f62c734a000)
</pre><p class="p">If the program is not compatible with tcp wrappers grep will not return anything.</p></div></div><div id="concept_nkp_1ry_pg" class="topic concept nested1"><h4 class="title topictitle2">Checking logs</h4><div class="body conbody"><p class="p">Whenever a connection is blocked it should be logged. Try checking the program's logs for relevant messages.</p><p class="p">In the logs for vsftpd, found at /var/log/vsftpd.log, a blocked connection due to tcp wrappers looks like this:</p><pre class="pre codeblock">Tue Jun  7 16:14:21 2011 [pid 28599] CONNECT: Client "203.0.113.43", "Connection refused: tcp_wrappers denial."
</pre></div></div><div id="concept_51j_cry_pg" class="topic concept nested1"><h4 class="title topictitle2">hosts.deny</h4><div class="body conbody"><p class="p">The /etc/hosts.deny file is where rules that block connections are defined. If you have troubke seeing an entry for your service in the file try using grep to search for it.</p><p class="p">Search the file for the program name</p><pre class="pre codeblock">sudo grep "vsftpd" /etc/hosts.deny
vsftpd : ALL
</pre><p class="p">Try commenting out any offending lines using a hash (#). Changes to this file take effect automatically – no services need to be restarted.</p><p class="p">Note that tcp wrappers will allow a connection by default so if it is the cause of the issue there must be an entry in /etc/hosts.deny for the service. You could rename the file /etc/hosts.deny to temporarily remove all your deny rules e.g. “<samp class="ph codeph">sudo mv /etc/hosts.deny /etc/hosts.deny.old</samp>”. Please be aware that this will affect all applications that use tcp wrappers.</p></div></div></div><div id="concept_1zs_5lj_qg" class="topic concept nested0"><h3 class="title topictitle1">Further investigation</h3><div class="body conbody"><p class="p">If you have completed all the tests described above without identifying any issues that is a good indication that the service is running normally on the server. The next step is to test the connectivity to the server by using <a href="http://www.rackspace.com/knowledge_center/article/ping-and-traceroute" target="_self">ping and traceroute</a> utilities.</p></div></div>
